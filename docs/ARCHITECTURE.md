# System Architecture

## Overview

The ThesisApp Rework is a hybrid architecture combining a monolithic Flask web application with microservice-based analyzers.

### Core Components

1.  **Web Application (`src/`)**
    *   **Framework**: Flask
    *   **Database**: SQLAlchemy (SQLite/PostgreSQL)
    *   **Task Queue**: ThreadPoolExecutor (Dev) / Celery (Prod)
    *   **Real-time**: Flask-SocketIO
    *   **Frontend**: Jinja2 templates + HTMX + Bootstrap 5

2.  **Analyzer System (`analyzer/`)**
    *   **Manager**: `AnalyzerManager` orchestrates analysis tasks.
    *   **Gateway**: WebSocket Gateway (`ws://0.0.0.0:8765`) for unified communication.
    *   **Services**:
        *   `static-analyzer`: Bandit, Semgrep, ESLint.
        *   `dynamic-analyzer`: OWASP ZAP, custom probes.
        *   `performance-tester`: Locust, ab.
        *   `ai-analyzer`: LLM-based code review (OpenRouter).

3.  **Generated Apps (`generated/apps/`)**
    *   Isolated web applications generated by AI models.
    *   Each app runs on its own port (dynamically allocated).

## Data Flow

1.  **Generation**: User requests an app -> `GenerationService` calls AI Model -> Code saved to `generated/apps/{model}/{app_id}`.
2.  **Analysis Trigger**: User/System requests analysis -> `AnalysisTask` created (PENDING).
3.  **Execution**: `TaskExecutionService` picks up task -> Calls `AnalyzerManager`.
4.  **Dispatch**: `AnalyzerManager` connects to relevant Analyzer Service via WebSocket.
5.  **Streaming**: Analyzer Service streams progress and findings back to Manager -> Web App -> UI (SocketIO).
6.  **Results**: Final results saved to `results/{model}/{app_id}/task_{id}/` and Database.

## Directory Structure

```
ThesisAppRework/
├── src/                # Main Flask Application
│   ├── app/            # App logic (routes, models, services)
│   ├── templates/      # Jinja2 templates
│   └── static/         # Static assets
├── analyzer/           # Analyzer Microservices
│   ├── services/       # Individual service code
│   └── shared/         # Shared protocol/utils
├── generated/          # AI-generated applications
├── results/            # Analysis results (JSON/SARIF)
├── docs/               # Documentation
└── scripts/            # Maintenance scripts
```

## Technologies

- **Backend**: Python 3.10+, Flask, SQLAlchemy
- **Frontend**: HTML5, CSS3, JavaScript (HTMX, Alpine.js)
- **Containerization**: Docker, Docker Compose
- **Communication**: WebSockets, HTTP REST
