{% if applications and applications|length > 0 %}
  <div class="card card-table-compact mb-2">
    <div class="table-responsive">
      <table class="table table-sm table-vcenter table-hover card-table mb-0"
             aria-label="Applications for selected model"
             id="applications-selection-table">
        <thead>
          <tr>
            <th class="w-1" aria-hidden="true"></th>
            <th class="text-nowrap">App #</th>
            <th>Status</th>
            <th>Type</th>
            <th>Framework</th>
            <th>Description</th>
            <th>Ports</th>
            <th class="text-nowrap text-end w-1">Action</th>
          </tr>
        </thead>
        <tbody>
          {% for app in applications %}
            {% set app_metadata = app.get_metadata() %}
            {% set ports = app.get_ports() %}
            <tr class="app-row" 
                data-app="{{ app.app_number }}"
                data-model-slug="{{ model_slug or app.model_slug or '' }}"
                style="cursor: pointer;"
                role="button"
                tabindex="0">
              <td class="text-muted"><i class="fa-solid fa-window-maximize"></i></td>
              <td class="fw-semibold text-nowrap">#{{ app.app_number }}</td>
              <td>
                {% if app.container_status == 'running' %}
                  <span class="badge bg-success-lt text-success">
                    <i class="fa-solid fa-play me-1"></i>Running
                  </span>
                {% elif app.container_status == 'stopped' %}
                  <span class="badge bg-warning-lt text-warning">
                    <i class="fa-solid fa-stop me-1"></i>Stopped
                  </span>
                {% else %}
                  <span class="badge bg-secondary-lt text-secondary">
                    <i class="fa-solid fa-question me-1"></i>{{ app.container_status or 'Unknown' }}
                  </span>
                {% endif %}
              </td>
              <td><span class="badge bg-secondary-lt text-secondary">{{ app.app_type or 'Unknown' }}</span></td>
              <td class="small">
                {% if app.backend_framework %}
                  <span class="badge bg-info-lt text-info me-1">{{ app.backend_framework }}</span>
                {% endif %}
                {% if app.frontend_framework %}
                  <span class="badge bg-success-lt text-success">{{ app.frontend_framework }}</span>
                {% endif %}
                {% if not app.backend_framework and not app.frontend_framework %}
                  <span class="text-muted">—</span>
                {% endif %}
              </td>
              <td class="small">
                {% if app_metadata.get('description') %}
                  {{ app_metadata.get('description')[:120] }}{% if app_metadata.get('description')|length > 120 %}…{% endif %}
                {% else %}
                  <span class="text-muted">—</span>
                {% endif %}
              </td>
              <td class="small">
                {% if ports and (ports.get('frontend') or ports.get('backend')) %}
                  {% if ports.get('frontend') %}
                    <span class="badge bg-primary-lt text-primary me-1">FE {{ ports.get('frontend') }}</span>
                  {% endif %}
                  {% if ports.get('backend') %}
                    <span class="badge bg-secondary-lt text-secondary">BE {{ ports.get('backend') }}</span>
                  {% endif %}
                {% else %}
                  <span class="text-muted">—</span>
                {% endif %}
              </td>
              <td class="text-end">
                <button type="button" 
                        class="btn btn-sm btn-ghost-primary select-app-btn"
                        data-select-app="{{ app.app_number }}"
                        data-select-model="{{ model_slug or app.model_slug or '' }}"
                        title="Select application #{{ app.app_number }}">
                  <i class="fa-solid fa-check me-1"></i>Select
                </button>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  <div class="mt-2 small text-muted">
    {% set running_count = applications|selectattr('container_status', 'equalto', 'running')|list|length %}
    <i class="fa-solid fa-info-circle me-1"></i>
    Showing {{ applications|length }} application{{ 's' if applications|length != 1 else '' }}{% if running_count > 0 %}, <span class="text-success fw-medium">{{ running_count }} running</span>{% endif %}.
  </div>
{% else %}
  <div class="empty py-5">
    <div class="empty-icon">
      <i class="fa-solid fa-inbox fa-3x text-muted"></i>
    </div>
    <p class="empty-title h5">No applications found</p>
    <p class="empty-subtitle text-muted">
      Applications may not have been generated yet, or may have been removed.
    </p>
  </div>
{% endif %}