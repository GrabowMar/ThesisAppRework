{% macro summary_card(title, value, subtitle='', tone='primary', col='col-md-3 col-sm-6') %}
  <div class="{{ col }}">
    <div class="card h-100 text-center">
      <div class="card-body py-3">
        <div class="text-muted text-uppercase tiny">{{ title }}</div>
        <div class="h2 mb-0 text-{{ tone }}">{{ value if value is not none and value != '' else '-' }}</div>
        {% if subtitle %}
          <div class="text-muted small">{{ subtitle }}</div>
        {% endif %}
      </div>
    </div>
  </div>
{% endmacro %}

{% macro status_badge(status, uppercase=True) %}
  {% set st = (status or 'Unknown') %}
  {% set key = st|lower %}
  {% if key in ['completed', 'success', 'succeeded'] %}
    {% set cls = 'bg-success-lt text-success' %}
    {% set icon = 'fa-check' %}
  {% elif key in ['running', 'in-progress', 'processing'] %}
    {% set cls = 'bg-warning-lt text-warning' %}
    {% set icon = 'fa-spinner fa-spin' %}
  {% elif key in ['failed', 'error', 'stopped'] %}
    {% set cls = 'bg-danger-lt text-danger' %}
    {% set icon = 'fa-triangle-exclamation' %}
  {% elif key in ['pending', 'queued', 'waiting'] %}
    {% set cls = 'bg-secondary-lt text-secondary' %}
    {% set icon = 'fa-clock' %}
  {% elif key in ['cancelled', 'canceled'] %}
    {% set cls = 'bg-muted text-body' %}
    {% set icon = 'fa-ban' %}
  {% else %}
    {% set cls = 'bg-muted text-body' %}
    {% set icon = 'fa-circle-info' %}
  {% endif %}
  <span class="badge {{ cls }} {{ 'text-uppercase' if uppercase }}">
    <i class="fas {{ icon }} me-1"></i>{{ st }}
  </span>
{% endmacro %}

{% macro severity_badge(severity) %}
  {% set sev = (severity or 'unknown')|lower %}
  {% if sev in ['critical'] %}
    {% set cls = 'bg-danger text-white' %}
  {% elif sev in ['high', 'error'] %}
    {% set cls = 'bg-danger-lt text-danger' %}
  {% elif sev in ['medium', 'warning'] %}
    {% set cls = 'bg-warning-lt text-warning' %}
  {% elif sev in ['low', 'info'] %}
    {% set cls = 'bg-info-lt text-info' %}
  {% else %}
    {% set cls = 'bg-secondary-lt text-secondary' %}
  {% endif %}
  <span class="badge {{ cls }} text-uppercase">{{ severity or 'Unknown' }}</span>
{% endmacro %}

{% macro empty_state(message, icon='fa-circle-info', tone='muted') %}
  <div class="text-center py-4 text-{{ tone }}">
    <i class="fas {{ icon }} fa-2x mb-2"></i>
    <div class="fw-semibold">{{ message }}</div>
  </div>
{% endmacro %}

{% macro key_value(label, value) %}
  <div class="d-flex justify-content-between align-items-start py-1 border-bottom small">
    <span class="text-muted">{{ label }}</span>
    <span class="text-end">{{ value if value is not none and value != '' else '-' }}</span>
  </div>
{% endmacro %}

{% macro progress_bar(value, max_value=100, tone='success') %}
  {% set raw_value = value if value is not none else 0 %}
  {% set safe_value = raw_value|float %}
  {% set clamped = [safe_value, max_value]|min %}
  <div class="progress" role="progressbar" aria-valuenow="{{ clamped }}" aria-valuemin="0" aria-valuemax="{{ max_value }}">
    <div class="progress-bar bg-{{ tone }}" style="width: {{ clamped }}%">
      {{ '%.1f'|format(safe_value) }}%
    </div>
  </div>
{% endmacro %}

{% macro tool_chip(name, tone='secondary') %}
  <span class="badge bg-{{ tone }} text-uppercase">{{ name }}</span>
{% endmacro %}
