{# Enhanced Statistics Cards with Tabler styling #}
<div class="row row-cards g-2 mb-3" id="dashboard-stats"
     hx-get="/api/dashboard/stats-fragment"
     hx-trigger="load, every 60s"
     hx-target="#dashboard-stats"
     hx-swap="innerHTML">
  
  <div class="col-6 col-lg-3">
    <div class="card card-sm">
      <div class="card-body">
        <div class="row align-items-center">
          <div class="col-auto">
            <span class="bg-primary text-white avatar">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <rect x="7" y="7" width="10" height="2" rx="1" />
                <rect x="7" y="15" width="10" height="2" rx="1" />
                <circle cx="12" cy="12" r="3" />
                <path d="M12 3v2" />
                <path d="M12 19v2" />
                <path d="M5 12h2" />
                <path d="M17 12h2" />
              </svg>
            </span>
          </div>
          <div class="col">
            <div class="font-weight-medium" id="total-models">{{ stats.total_models|default(0) }}</div>
            <div class="text-muted">AI Models</div>
          </div>
        </div>
        <div class="d-flex align-items-baseline">
          <div class="h1 mb-0 me-2" id="active-models">{{ stats.active_models|default(0) }}</div>
          <div class="me-auto">
            <span class="text-green d-inline-flex align-items-center lh-1">
              active
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-3 col-md-6">
    <div class="card card-sm">
      <div class="card-body d-flex align-items-center">
        <span class="avatar me-3 bg-success text-white">
          <i class="fas fa-flask"></i>
        </span>
        <div>
          <div class="h1" id="total-analyses">{{ stats.total_security_analyses|default(0) }}</div>
          <div class="text-muted">Security Analyses</div>
        </div>
      </div>
      <div class="progress progress-sm">
        <div class="progress-bar bg-success"></div>
      </div>
      <div class="card-footer">
        <div class="d-flex justify-content-between text-muted">
          <span>Today: <span id="today-analyses">{{ stats.today_analyses|default(0) }}</span></span>
          <span class="text-info"><i class="fas fa-chart-line"></i></span>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-3 col-md-6">
    <div class="card card-sm">
      <div class="card-body d-flex align-items-center">
        <span class="avatar me-3 bg-warning text-white">
          <i class="fas fa-code"></i>
        </span>
        <div>
          <div class="h1" id="total-applications">{{ stats.total_applications|default(0) }}</div>
          <div class="text-muted">Applications</div>
        </div>
      </div>
      <div class="progress progress-sm">
        <div class="progress-bar bg-warning"></div>
      </div>
      <div class="card-footer">
        <div class="d-flex justify-content-between text-muted">
          <span>Running: <span id="running-apps">{{ stats.running_apps|default(0) }}</span></span>
          <span class="text-primary"><i class="fas fa-cogs"></i></span>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-3 col-md-6">
    <div class="card card-sm">
      <div class="card-body d-flex align-items-center">
        <span class="avatar me-3 bg-info text-white">
          <i class="fas fa-tachometer-alt"></i>
        </span>
        <div>
          <div class="h1" id="performance-tests">{{ stats.total_performance_tests|default(0) }}</div>
          <div class="text-muted">Performance Tests</div>
        </div>
      </div>
      <div class="progress progress-sm">
        <div class="progress-bar bg-info"></div>
      </div>
      <div class="card-footer">
        <div class="d-flex justify-content-between text-muted">
          <span>Issues: <span id="performance-issues">{{ stats.performance_issues|default(0) }}</span></span>
          <span class="text-success"><i class="fas fa-check-circle"></i></span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Additional Tool Registry Overview -->
<div class="row mt-4" id="tool-registry-overview">
  <div class="col-12">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h6 class="card-title mb-0">
          <i class="fas fa-tools me-2 text-warning"></i>
          Tool Registry Overview
        </h6>
        <button class="btn btn-sm btn-outline-warning" onclick="refreshToolRegistry()">
          <i class="fas fa-sync-alt me-1"></i>Refresh
        </button>
      </div>
      <div class="card-body py-2" id="tool-registry-mini">
        <div class="row text-center">
          <div class="col-3">
            <div class="text-primary h4 mb-1" id="tools-count">--</div>
            <small class="text-muted">Tools</small>
          </div>
          <div class="col-3">
            <div class="text-success h4 mb-1" id="enabled-tools-count">--</div>
            <small class="text-muted">Enabled</small>
          </div>
          <div class="col-3">
            <div class="text-warning h4 mb-1" id="profiles-count">--</div>
            <small class="text-muted">Profiles</small>
          </div>
          <div class="col-3">
            <div class="text-info h4 mb-1" id="categories-count">--</div>
            <small class="text-muted">Categories</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Enhanced stats auto-refresh with tool registry integration
document.addEventListener('DOMContentLoaded', function() {
  // Initial load of tool registry overview
  refreshToolRegistryMini();
  
  // Auto-refresh tool registry mini every 2 minutes
  setInterval(refreshToolRegistryMini, 120000);
});

async function refreshToolRegistryMini() {
  try {
    const response = await fetch('/api/dashboard/tool-registry-summary');
    const data = await response.json();
    
    if (data.success && data.data) {
      const summary = data.data.summary;
      document.getElementById('tools-count').textContent = summary.total_tools || 0;
      document.getElementById('enabled-tools-count').textContent = summary.enabled_tools || 0;
      document.getElementById('profiles-count').textContent = summary.total_profiles || 0;
      document.getElementById('categories-count').textContent = summary.total_categories || 0;
    }
  } catch (error) {
    console.warn('Failed to refresh tool registry mini overview:', error);
  }
}

// Update overview counts from main dashboard stats
function updateOverviewCounts(stats) {
  document.getElementById('overview-models-count').textContent = stats.total_models || 0;
  document.getElementById('overview-apps-count').textContent = stats.total_applications || 0;
  document.getElementById('overview-analyses-count').textContent = stats.total_security_analyses || 0;
}

// Listen for HTMX stats updates
document.addEventListener('htmx:afterRequest', function(event) {
  if (event.detail.xhr.responseURL.includes('stats-fragment')) {
    // Stats were updated via HTMX, could trigger other updates here
    console.log('Dashboard stats refreshed via HTMX');
  }
});
</script>
