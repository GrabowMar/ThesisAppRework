{% if applications %}
<table class="table table-vcenter table-sm card-table table-ultra-compact mb-0">
  <thead>
    <tr>
      <th style="width: 50px">App</th>
      <th>Model / Type</th>
      <th style="width: 70px">Status</th>
      <th style="width: 70px" class="text-end">Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for app in applications %}
    <tr>
      <td>
        <span class="badge bg-primary-lt" style="font-size: 0.75rem;">#{{ app.app_number }}</span>
      </td>
      <td>
        <div class="d-flex align-items-center gap-2">
          <span class="text-truncate" style="max-width: 120px; font-size: 0.8rem;">{{ (app.model_display_name|truncate(18)) if app.model_display_name else (app.model_slug|truncate(18) if app.model_slug else 'â€”') }}</span>
          {% if app.app_type %}
            <span class="badge bg-secondary-lt" style="font-size: 0.65rem; padding: 1px 4px;">{{ (app.app_type|replace('_', ' ')|truncate(10, true, '')) }}</span>
          {% endif %}
          <span class="text-muted ms-auto" style="font-size: 0.75rem;">{{ app.created_at.strftime('%m/%d') if app.created_at else '' }}</span>
        </div>
      </td>
      <td>
        {% if app.status == 'running' %}
          <span class="badge bg-success-lt text-success" style="font-size: 0.7rem;">Up</span>
        {% elif app.status == 'stopped' %}
          <span class="badge bg-secondary-lt" style="font-size: 0.7rem;">Off</span>
        {% elif app.status == 'error' %}
          <span class="badge bg-danger-lt text-danger" style="font-size: 0.7rem;">Err</span>
        {% elif app.status == 'building' %}
          <span class="badge bg-warning-lt text-warning" style="font-size: 0.7rem;"><i class="fas fa-spinner fa-spin"></i></span>
        {% else %}
          <span class="badge bg-secondary-lt" style="font-size: 0.7rem;">{{ (app.status|truncate(3, true, '')|title) if app.status else '?' }}</span>
        {% endif %}
      </td>
      <td class="text-end">
        <div class="btn-list justify-content-end gap-0">
          <a href="/applications/{{ app.model_slug }}/{{ app.app_number }}" class="btn btn-sm btn-icon btn-ghost-primary py-0" title="View">
            <i class="fas fa-eye" style="font-size: 0.75rem;"></i>
          </a>
          {% if app.status == 'running' and app.ports %}
            {% set frontend_port = app.ports[1].host_port if app.ports|length > 1 else app.ports[0].host_port %}
            <a href="http://{{ request.host.split(':')[0] }}:{{ frontend_port }}" target="_blank" class="btn btn-sm btn-icon btn-ghost-success py-0" title="Open">
              <i class="fas fa-external-link-alt" style="font-size: 0.75rem;"></i>
            </a>
          {% endif %}
        </div>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<div class="text-center py-3">
  <i class="fas fa-cubes text-muted mb-2" style="font-size: 1.5rem;"></i>
  <p class="text-muted mb-2" style="font-size: 0.85rem;">No applications yet</p>
  <a href="{{ url_for('applications.applications_index') if 'applications.applications_index' in current_app.view_functions else '/applications' }}" class="btn btn-sm btn-primary">Generate App</a>
</div>
{% endif %}