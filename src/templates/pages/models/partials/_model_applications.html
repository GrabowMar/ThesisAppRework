{% if applications %}
<div class="row g-2">
  {# Applications Table - Main focus #}
  <div class="col-12">
    <div class="card card-sm">
      <div class="card-header py-2 d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
          <i class="fas fa-cubes text-primary me-2"></i>
          <span class="fw-bold">Applications</span>
          <span class="badge bg-secondary-lt ms-2">{{ applications | length }}</span>
        </div>
        <button class="btn btn-primary btn-sm py-1" onclick="generateApplication()">
          <i class="fas fa-plus me-1"></i>New
        </button>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-vcenter table-hover card-table table-sm">
            <thead>
              <tr>
                <th>#</th>
                <th>Version</th>
                <th>Template</th>
                <th>Status</th>
                <th>Created</th>
                <th class="text-end">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for app in applications %}
              <tr>
                <td>
                  <span class="badge bg-primary-lt text-primary">{{ app.app_number }}</span>
                  {% if app_version_counts and app_version_counts.get(app.app_number, 1) > 1 %}
                    <span class="badge bg-cyan-lt ms-1" title="{{ app_version_counts.get(app.app_number, 1) }} versions">
                      <i class="fas fa-code-branch"></i>{{ app_version_counts.get(app.app_number, 1) }}
                    </span>
                  {% endif %}
                </td>
                <td>
                  <span class="badge bg-purple-lt">v{{ app.version or 1 }}</span>
                  {% if app.parent_app_id %}<i class="fas fa-undo text-muted ms-1" title="Regenerated"></i>{% endif %}
                </td>
                <td>
                  {% if app.template_slug %}<span class="badge bg-indigo-lt">{{ app.template_slug }}</span>
                  {% else %}<span class="text-muted small">Default</span>{% endif %}
                </td>
                <td>
                  {% if app.container_status == 'running' %}
                    <span class="badge bg-success-lt text-success"><span class="status-dot status-dot-animated status-success me-1"></span>Running</span>
                  {% elif app.generation_status == 'completed' %}
                    <span class="badge bg-info-lt text-info">Generated</span>
                  {% elif app.generation_status == 'failed' %}
                    <span class="badge bg-danger-lt text-danger">Failed</span>
                  {% else %}
                    <span class="badge bg-warning-lt text-warning">{{ app.generation_status or 'Pending' }}</span>
                  {% endif %}
                </td>
                <td class="text-muted small">{% if app.created_at %}{{ app.created_at.strftime('%m/%d %H:%M') }}{% else %}â€”{% endif %}</td>
                <td class="text-end">
                  <div class="btn-list flex-nowrap justify-content-end gap-1">
                    <a href="/applications/{{ model_slug }}/{{ app.app_number }}" class="btn btn-sm btn-ghost-primary py-0" title="View"><i class="fas fa-eye"></i></a>
                    {% if app.container_status == 'running' %}
                      <button class="btn btn-sm btn-ghost-success py-0" onclick="window.open('http://localhost:{{ app.frontend_port or '3000' }}', '_blank')" title="Open"><i class="fas fa-external-link-alt"></i></button>
                    {% endif %}
                    <button class="btn btn-sm btn-ghost-cyan py-0" onclick="regenerateApplication('{{ model_slug }}', {{ app.app_number }})" title="Regenerate"><i class="fas fa-sync"></i></button>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% else %}
<div class="card card-sm">
  <div class="card-body py-4 text-center">
    <i class="fas fa-cube text-muted fa-2x mb-2" aria-hidden="true"></i>
    <p class="mb-2 text-muted">No applications generated yet</p>
    <button class="btn btn-primary btn-sm" onclick="generateApplication()">
      <i class="fas fa-plus me-1"></i>Generate First Application
    </button>
  </div>
</div>
{% endif %}
