{# Models table content — consistent with Applications table style #}
{% set per_page_val = request.args.get('per_page','25') if request else '25' %}
{% set search_term = request.args.get('search','') if request else '' %}
{% if provider_options is not defined %}
	{% set provider_options = [] %}
{% endif %}
<div class="card card-table-compact mb-3">
	<div class="card-header d-flex flex-wrap align-items-center gap-2">
		<h3 class="card-title d-flex align-items-center gap-2 mb-0">
			<i class="fa-solid fa-brain text-primary"></i>
			<span>Models</span>
		</h3>
		<div class="d-flex flex-wrap align-items-center gap-1 status-indicators ms-1">
			<span class="badge bg-primary-lt text-primary d-inline-flex align-items-center gap-1" title="Total models">
				<i class="fa-solid fa-brain fa-xs"></i><span id="total-models">{{ models_stats.total_models }}</span>
			</span>
			<span class="badge bg-success-lt text-success d-inline-flex align-items-center gap-1" title="Active models">
				<i class="fa-solid fa-check-circle fa-xs"></i><span id="active-models">{{ models_stats.active_models }}</span>
			</span>
			<span class="badge bg-info-lt text-info d-inline-flex align-items-center gap-1" title="Unique providers">
				<i class="fa-solid fa-building fa-xs"></i><span id="unique-providers">{{ models_stats.unique_providers }}</span>
			</span>
			<span class="badge bg-warning-lt text-orange d-inline-flex align-items-center gap-1" title="Avg cost per 1K tokens">
				<i class="fa-solid fa-dollar-sign fa-xs"></i><span id="avg-cost">{{ models_stats.avg_cost_per_1k|round(4) }}</span>
			</span>
		</div>
		<div class="card-actions d-flex flex-wrap align-items-center gap-2 ms-auto">
			<label class="d-flex align-items-center gap-1 mb-0">
				<span class="text-muted small">Show:</span>
				<select id="models-per-page" class="form-select form-select-sm" style="width:auto;" onchange="changePerPage(this.value)">
					<option value="10" {% if per_page_val|string == '10' %}selected{% endif %}>10</option>
					<option value="25" {% if per_page_val|string == '25' %}selected{% endif %}>25</option>
					<option value="50" {% if per_page_val|string == '50' %}selected{% endif %}>50</option>
					<option value="100" {% if per_page_val|string == '100' %}selected{% endif %}>100</option>
				</select>
			</label>
			<div class="btn-group btn-group-sm" role="group" aria-label="Model data source">
				<button type="button" class="btn btn-outline-secondary active" id="src-db" onclick="setModelsSource('db')"><i class="fa-solid fa-database me-1" aria-hidden="true"></i>All</button>
				<button type="button" class="btn btn-outline-secondary" id="src-used" onclick="setModelsSource('used')" title="Models used for app generation"><i class="fa-solid fa-tag me-1" aria-hidden="true"></i>Used</button>
			</div>
			<span class="text-muted small" id="models-source-indicator"></span>
			<div class="btn-list">
				<button class="btn btn-sm btn-primary" onclick="compareSelectedModels()" title="Compare selected models" type="button" id="compare-models-btn" disabled><i class="fa-solid fa-balance-scale me-1" aria-hidden="true"></i>Compare</button>
				<button type="button" class="btn btn-sm btn-outline-info" id="btn-sync-openrouter" onclick="syncFromOpenRouter()" title="Refresh models from OpenRouter API">
					<i class="fa-solid fa-cloud-download-alt me-1" aria-hidden="true"></i><span class="d-none d-md-inline">Sync</span>
				</button>
				<div class="btn-group btn-group-sm">
					<button type="button" class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
						<i class="fa-solid fa-ellipsis-v"></i>
					</button>
					<ul class="dropdown-menu dropdown-menu-end">
						<li><a class="dropdown-item" href="{{ url_for('rankings.rankings_index') }}"><i class="fa-solid fa-trophy me-2 text-warning"></i>Rankings</a></li>
						<li><hr class="dropdown-divider"></li>
						<li><a class="dropdown-item" href="#" onclick="exportModels('json'); return false;"><i class="fa-solid fa-file-code me-2"></i>Export JSON</a></li>
					</ul>
				</div>
			</div>
			<div class="d-flex align-items-center gap-2">
				<span class="text-primary small fw-bold" id="models-selection-indicator"></span>
				<button class="btn btn-sm btn-ghost-danger" onclick="clearModelSelection()" title="Clear selection" type="button" id="clear-selection-btn" style="display:none;">
					<i class="fa-solid fa-times" aria-hidden="true"></i>
				</button>
			</div>
		</div>
	</div>
	{# Unified filter bar — search + dropdowns in one compact row #}
	<div class="card-body border-top py-2">
		<div class="d-flex flex-wrap align-items-center gap-2">
			<div class="input-group input-group-flat" style="max-width:260px;">
				<span class="input-group-text py-1"><i class="fa-solid fa-search fa-sm" aria-hidden="true"></i></span>
				<input type="text" id="model-search" class="form-control form-control-sm" placeholder="Search models..." value="{{ search_term }}" onkeyup="debounceSearch()" aria-label="Search models" />
				<button class="btn btn-sm btn-outline-secondary border-0" onclick="clearSearch()" type="button" title="Clear" aria-label="Clear search"><i class="fa-solid fa-xmark fa-sm" aria-hidden="true"></i></button>
			</div>
			<select class="form-select form-select-sm" style="width:160px;" id="provider-filter" onchange="applyFilters()" aria-label="Filter by provider">
				<option value="">All Providers</option>
				{% for provider in provider_options %}
				<option value="{{ provider }}">{{ provider }}</option>
				{% endfor %}
			</select>
			<select class="form-select form-select-sm" style="width:140px;" id="price-filter" onchange="applyFilters()" aria-label="Filter by price">
				<option value="">All Prices</option>
				<option value="free">Free Only</option>
				<option value="low">Low (&lt;$0.001)</option>
				<option value="medium">Medium</option>
				<option value="high">High (&gt;$0.01)</option>
			</select>
			<select class="form-select form-select-sm" style="width:140px;" id="context-filter" onchange="applyFilters()" aria-label="Filter by context">
				<option value="">Any Context</option>
				<option value="small">&lt;8K</option>
				<option value="medium">8K–32K</option>
				<option value="large">32K–128K</option>
				<option value="xlarge">&gt;128K</option>
			</select>
			{# More filters dropdown — matches applications pattern #}
			<div class="dropdown">
				<button class="btn btn-sm btn-outline-secondary py-1" data-bs-toggle="dropdown" data-bs-auto-close="outside" type="button" id="more-filters-btn" style="line-height:1.5;">
					<i class="fa-solid fa-sliders fa-sm me-1"></i>More
					<span class="badge bg-primary ms-1" id="active-filters-count" style="display:none;">0</span>
				</button>
				<div class="dropdown-menu p-3" style="min-width:360px;">
					<h6 class="dropdown-header px-0 pt-0">Features</h6>
					<div class="d-flex flex-wrap gap-2 mb-3">
						<label class="form-check form-check-inline mb-0">
							<input type="checkbox" class="form-check-input feature-filter" id="filter-function-calling" value="function_calling" onchange="applyFilters()">
							<span class="form-check-label small">Function Calling</span>
						</label>
						<label class="form-check form-check-inline mb-0">
							<input type="checkbox" class="form-check-input feature-filter" id="filter-vision" value="vision" onchange="applyFilters()">
							<span class="form-check-label small">Vision</span>
						</label>
						<label class="form-check form-check-inline mb-0">
							<input type="checkbox" class="form-check-input feature-filter" id="filter-json-mode" value="json_mode" onchange="applyFilters()">
							<span class="form-check-label small">JSON Mode</span>
						</label>
						<label class="form-check form-check-inline mb-0">
							<input type="checkbox" class="form-check-input feature-filter" id="filter-streaming" value="streaming" onchange="applyFilters()">
							<span class="form-check-label small">Streaming</span>
						</label>
					</div>
					<h6 class="dropdown-header px-0">Modalities</h6>
					<div class="d-flex flex-wrap gap-2 mb-3">
						<label class="form-check form-check-inline mb-0">
							<input class="form-check-input modality-filter" type="checkbox" id="filter-text-input" value="text" onchange="applyFilters()">
							<span class="form-check-label small">Text</span>
						</label>
						<label class="form-check form-check-inline mb-0">
							<input class="form-check-input modality-filter" type="checkbox" id="filter-image-input" value="image" onchange="applyFilters()">
							<span class="form-check-label small">Image</span>
						</label>
						<label class="form-check form-check-inline mb-0">
							<input class="form-check-input modality-filter" type="checkbox" id="filter-audio-input" value="audio" onchange="applyFilters()">
							<span class="form-check-label small">Audio</span>
						</label>
						<label class="form-check form-check-inline mb-0">
							<input class="form-check-input modality-filter" type="checkbox" id="filter-video-input" value="video" onchange="applyFilters()">
							<span class="form-check-label small">Video</span>
						</label>
					</div>
					<h6 class="dropdown-header px-0">Architecture</h6>
					<div class="row g-2 mb-3">
						<div class="col-6">
							<select class="form-select form-select-sm" id="instruct-type-filter" onchange="applyFilters()">
								<option value="">Any Type</option>
								<option value="none">Base Model</option>
								<option value="chat">Chat</option>
								<option value="instruction">Instruction</option>
							</select>
						</div>
						<div class="col-6">
							<select class="form-select form-select-sm" id="tokenizer-filter" onchange="applyFilters()">
								<option value="">Any Tokenizer</option>
								<option value="gpt">GPT / Claude</option>
								<option value="llama">Llama</option>
								<option value="qwen">Qwen</option>
								<option value="mistral">Mistral</option>
								<option value="other">Other</option>
							</select>
						</div>
					</div>
					<h6 class="dropdown-header px-0">Status</h6>
					<div class="d-flex flex-wrap gap-2 mb-3">
						<label class="form-check form-check-inline mb-0">
							<input class="form-check-input" type="checkbox" id="filter-free-models" onchange="applyFilters()">
							<span class="form-check-label small"><i class="fa-solid fa-gift text-success me-1"></i>Free</span>
						</label>
						<label class="form-check form-check-inline mb-0">
							<input class="form-check-input" type="checkbox" id="filter-installed-only" onchange="applyFilters()">
							<span class="form-check-label small"><i class="fa-solid fa-download text-info me-1"></i>Used</span>
						</label>
					</div>
					<div class="row g-2 mb-2">
						<div class="col-6">
							<label class="form-label small text-muted mb-1">Max Output</label>
							<select class="form-select form-select-sm" id="max-output-filter" onchange="applyFilters()">
								<option value="">Any</option>
								<option value="small">&lt;4K</option>
								<option value="medium">4K–16K</option>
								<option value="large">&gt;16K</option>
							</select>
						</div>
						<div class="col-6">
							<label class="form-label small text-muted mb-1">Cost Efficiency</label>
							<select class="form-select form-select-sm" id="cost-efficiency-filter" onchange="applyFilters()">
								<option value="">Any</option>
								<option value="high">&gt;0.7 (High)</option>
								<option value="medium">0.3–0.7</option>
								<option value="low">&lt;0.3 (Low)</option>
							</select>
						</div>
					</div>
				</div>
			</div>
			<button class="btn btn-sm btn-outline-secondary py-1" onclick="clearAllFilters()" type="button" style="line-height:1.5;">Clear</button>
		</div>
	</div>
	<div class="table-responsive">
		<table class="table table-striped table-vcenter table-hover table-sm card-table mb-0" id="models-table">
			<thead>
				<tr>
					<th scope="col" class="w-1">
						<input type="checkbox" id="select-all-models" class="form-check-input" onchange="toggleSelectAll()" />
					</th>
					<th scope="col" class="sortable" data-column="name">Model</th>
					<th scope="col" class="text-center sortable" data-column="modality">Modality</th>
					<th scope="col" class="text-center sortable" data-column="type">Type</th>
					<th scope="col" class="text-center sortable" data-column="price">Price / 1M</th>
					<th scope="col" class="text-center sortable" data-column="context">Context</th>
					<th scope="col" class="text-center sortable" data-column="cost_efficiency">Efficiency</th>
					<th scope="col" class="text-center">Features</th>
					<th scope="col" class="w-1"><span class="visually-hidden">Actions</span></th>
				</tr>
			</thead>
			<tbody id="models-table-body"></tbody>
		</table>
	</div>
	<div class="card-footer d-flex align-items-center gap-2 justify-content-between" id="models-pagination-bar">
		<div id="models-page-summary" class="text-muted">Page 1</div>
		<nav aria-label="Models pagination">
			<ul class="pagination pagination-sm mb-0" id="models-pagination"></ul>
		</nav>
	</div>
</div>
<div id="comparison-panel" class="mt-3"></div>
<div id="loading-spinner" class="text-center py-4">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
  <p class="text-muted mt-2">Loading models...</p>
</div>
