{% extends 'layouts/base.html' %}
{% set active_page = 'reports' %}
{% set page_title = 'Reports' %}
{% set page_icon = 'fa-solid fa-file-lines' %}
{% set has_right_sidebar = true %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
  <!-- Page Header -->
  <div class="page-header mb-4">
    <div class="row align-items-center">
      <div class="col-auto">
        <span class="page-icon bg-primary-lt text-primary rounded-3 p-2">
          <i class="{{ page_icon }} fa-lg"></i>
        </span>
      </div>
      <div class="col">
        <h1 class="page-title mb-1">{{ page_title }}</h1>
        <p class="text-muted mb-0">Generated analysis summaries</p>
      </div>
      <div class="col-auto ms-auto d-print-none">
        <div class="btn-list">
          <button class="btn btn-primary d-sm-none btn-icon" hx-get="/reports/new" hx-target="#modal-region" aria-label="Generate Report">
            <i class="fa-solid fa-plus"></i>
          </button>
          <button class="btn btn-primary d-none d-sm-inline-block" hx-get="/reports/new" hx-target="#modal-region">
            <i class="fa-solid fa-plus me-2"></i>Generate Report
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="card card-table-compact" data-component="reports-index">
    <div class="card-header d-flex flex-wrap align-items-center gap-3">
      <h3 class="card-title d-flex align-items-center gap-2 mb-0">
        <i class="fa-solid fa-list"></i>
        <span>All Reports</span>
      </h3>
      <div class="card-actions ms-auto">
        <div class="btn-list">
          <button class="btn btn-sm btn-ghost-primary btn-icon" title="Refresh" onclick="window.location.reload()">
            <i class="fa-solid fa-sync"></i>
          </button>
        </div>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table table-vcenter table-hover card-table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Type</th>
            <th>Format</th>
            <th>Status</th>
            <th>Created</th>
            <th class="w-1">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% if reports %}
            {% for r in reports %}
            <tr>
              <td>
                <div class="font-weight-medium">{{ r.title }}</div>
                {% if r.description %}
                <div class="text-muted small text-truncate" style="max-width: 300px;">{{ r.description }}</div>
                {% endif %}
              </td>
              <td><span class="badge bg-blue-lt">{{ r.report_type.replace('_', ' ')|title }}</span></td>
              <td><span class="badge bg-secondary-lt">{{ r.format|upper }}</span></td>
              <td>
                {% if r.status == 'completed' %}
                <span class="badge bg-success">Completed</span>
                {% elif r.status == 'generating' %}
                <span class="badge bg-warning text-dark">Generating</span>
                {% elif r.status == 'failed' %}
                <span class="badge bg-danger">Failed</span>
                {% else %}
                <span class="badge bg-secondary">{{ r.status|capitalize }}</span>
                {% endif %}
              </td>
              <td class="text-muted small">{{ r.created_at.strftime('%Y-%m-%d %H:%M') if r.created_at else 'N/A' }}</td>
              <td>
                <div class="btn-list flex-nowrap">
                  {% if r.status == 'completed' %}
                    {% if r.format == 'html' %}
                    <a href="/reports/view/{{ r.report_id }}" class="btn btn-sm btn-ghost-primary btn-icon" title="View">
                      <i class="fa-solid fa-eye"></i>
                    </a>
                    {% endif %}
                    <a href="/api/reports/{{ r.report_id }}/download" class="btn btn-sm btn-ghost-primary btn-icon" title="Download">
                      <i class="fa-solid fa-download"></i>
                    </a>
                  {% else %}
                    <span class="text-muted small">-</span>
                  {% endif %}
                </div>
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="6">
                <div class="empty py-5">
                  <div class="empty-icon">
                    <i class="fa-solid fa-file-lines fa-3x text-muted"></i>
                  </div>
                  <p class="empty-title h5">No reports yet</p>
                  <p class="empty-subtitle text-muted">
                    Generate your first analysis report to get started.
                  </p>
                  <div class="empty-action">
                    <button class="btn btn-primary" hx-get="/reports/new" hx-target="#modal-region">
                      <i class="fa-solid fa-plus me-2"></i>Generate Report
                    </button>
                  </div>
                </div>
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}

{% block right_sidebar %}
<div class="d-flex flex-column gap-3">
  <div class="card">
    <div class="card-body">
      <div class="d-flex align-items-center mb-2">
        <i class="fa-solid fa-circle-info me-2 text-primary"></i>
        <h3 class="card-title mb-0">About Reports</h3>
      </div>
      <div class="text-muted small">
        Generate comprehensive analysis summaries for models, applications, and tools. Reports can be viewed online or downloaded.
      </div>
    </div>
  </div>
  
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Quick Actions</h3>
    </div>
    <div class="card-body d-flex flex-column gap-2">
      <button class="btn btn-primary w-100" hx-get="/reports/new" hx-target="#modal-region">
        <i class="fa-solid fa-plus me-2"></i>Generate Report
      </button>
    </div>
  </div>
</div>
{% endblock %}
