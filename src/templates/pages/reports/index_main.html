{#
  Page: Reports Index
  Template: pages/reports/index_main.html
  Layout: layouts/base.html
  Purpose: Entry point to select and view generated analysis reports.
  Context:
    - reports: list[ReportRecord]
#}
{% extends 'layouts/base.html' %}
{% set has_right_sidebar = true %}
{% set page_title = 'Reports' %}
{% set page_icon = 'fas fa-file-lines' %}
{% set page_subtitle = 'Generated analysis summaries' %}
{% block content %}
  <div class="card" data-component="reports-index">
    <div class="table-responsive">
      <table class="table table-sm table-striped table-vcenter card-table mb-0">
        <thead>
          <tr>
            <th>Title</th>
            <th>Type</th>
            <th>Format</th>
            <th>Status</th>
            <th>Created</th>
            <th class="w-1"></th>
          </tr>
        </thead>
        <tbody>
          {% if reports %}
            {% for r in reports %}
            <tr>
              <td>
                <strong>{{ r.title }}</strong>
                {% if r.description %}
                <br><small class="text-muted">{{ r.description[:100] }}</small>
                {% endif %}
              </td>
              <td><span class="badge bg-info">{{ r.report_type.replace('_', ' ')|title }}</span></td>
              <td><span class="badge bg-secondary">{{ r.format|upper }}</span></td>
              <td>
                {% if r.status == 'completed' %}
                <span class="badge bg-success">Completed</span>
                {% elif r.status == 'generating' %}
                <span class="badge bg-warning">Generating...</span>
                {% elif r.status == 'failed' %}
                <span class="badge bg-danger">Failed</span>
                {% else %}
                <span class="badge bg-secondary">{{ r.status|capitalize }}</span>
                {% endif %}
              </td>
              <td class="text-muted small">{{ r.created_at.strftime('%Y-%m-%d %H:%M') if r.created_at else 'N/A' }}</td>
              <td>
                {% if r.status == 'completed' %}
                <div class="btn-group btn-group-sm">
                  {% if r.format == 'html' %}
                  <a href="/reports/view/{{ r.report_id }}" class="btn btn-ghost-primary" title="View">
                    <i class="fas fa-eye"></i>
                  </a>
                  {% endif %}
                  <a href="/api/reports/{{ r.report_id }}/download" class="btn btn-ghost-primary" title="Download">
                    <i class="fas fa-download"></i>
                  </a>
                </div>
                {% else %}
                <span class="text-muted small">N/A</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="6" class="text-center text-muted py-4">
                <div class="empty">
                  <div class="empty-icon">
                    <i class="fa-regular fa-file-lines fa-2x text-muted" aria-hidden="true"></i>
                  </div>
                  <p class="empty-title">No reports yet</p>
                  <p class="empty-subtitle text-muted">Generate your first analysis report to get started</p>
                </div>
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}

{% block right_sidebar %}
<div class="d-flex flex-column gap-3">
  <div class="card">
    <div class="card-body pb-2">
      <div class="d-flex align-items-center mb-2"><i class="fas fa-file-lines me-2 text-primary"></i><strong>Reports</strong></div>
      <div class="text-muted small">Generated analysis summaries</div>
    </div>
  </div>
  <div class="card">
    <div class="card-header py-2"><strong>Actions</strong></div>
    <div class="card-body d-flex flex-column gap-2">
      <button class="btn btn-primary btn-sm w-100 d-flex align-items-center justify-content-center" hx-get="/reports/new" hx-target="#modal-region">
        <i class="fa-solid fa-plus me-2" aria-hidden="true"></i>
        <span>Generate Report</span>
      </button>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    // Reports page hooks
  </script>
{% endblock %}
