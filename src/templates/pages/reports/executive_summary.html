{# Executive Summary Report Template #}
{% extends 'layouts/base.html' %}
{% set page_title = report.title %}
{% set page_icon = 'fa-solid fa-chart-pie' %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/analysis-report.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/report-print.css') }}">
{% endblock %}

{% block content %}
<div class="report-container py-4">
  <!-- Page Header -->
  <div class="page-header mb-4">
    <div class="row align-items-center">
      <div class="col-auto">
        <span class="page-icon bg-primary-lt text-primary rounded-3 p-2">
          <i class="{{ page_icon }} fa-lg"></i>
        </span>
      </div>
      <div class="col">
        <h1 class="page-title mb-1">{{ page_title }}</h1>
        <p class="text-muted mb-0">High-level overview of system analysis activities</p>
      </div>
      <div class="col-auto ms-auto d-print-none">
        <div class="btn-list">
          <button class="btn btn-primary" onclick="window.print()">
            <i class="fa-solid fa-print me-2"></i>Print
          </button>
        </div>
      </div>
    </div>
    <div class="row mt-2">
      <div class="col-12">
        <div class="text-muted small">
          <i class="fa-solid fa-calendar me-2"></i>Generated: {{ data.timestamp or 'N/A' }}
          {% if data.date_range.start or data.date_range.end %}
          <span class="mx-2">|</span>
          <i class="fa-solid fa-filter me-2"></i>Period: 
          {{ data.date_range.start[:10] if data.date_range.start else 'Beginning' }} to 
          {{ data.date_range.end[:10] if data.date_range.end else 'Now' }}
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Key Performance Indicators -->
  <div class="row row-cards g-2 mb-4">
    <div class="col-6 col-lg-3">
      <div class="card card-sm">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="subheader text-muted text-uppercase small">Apps Generated</div>
          </div>
          <div class="h1 mb-0">{{ data.summary.total_apps_generated or 0 }}</div>
        </div>
      </div>
    </div>
    <div class="col-6 col-lg-3">
      <div class="card card-sm">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="subheader text-muted text-uppercase small">Analyses Completed</div>
          </div>
          <div class="h1 mb-0">{{ data.summary.total_analyses_completed or 0 }}</div>
        </div>
      </div>
    </div>
    <div class="col-6 col-lg-3">
      <div class="card card-sm">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="subheader text-muted text-uppercase small">Total Findings</div>
          </div>
          <div class="h1 mb-0">{{ data.summary.total_findings or 0 }}</div>
        </div>
      </div>
    </div>
    <div class="col-6 col-lg-3">
      <div class="card card-sm">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="subheader text-muted text-uppercase small">AI Models Used</div>
          </div>
          <div class="h1 mb-0">{{ data.summary.total_models or 0 }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Severity Overview -->
  {% if data.summary.severity_breakdown %}
  <div class="card mb-4">
    <div class="card-header">
      <h3 class="card-title">Severity Distribution</h3>
    </div>
    <div class="card-body">
      <div class="row g-3">
        {% set severity_data = data.summary.severity_breakdown %}
        <div class="col-md-{{ 12 // 5 if severity_data|length >= 5 else 12 // severity_data|length }}">
          <div class="severity-box severity-critical text-center p-3 rounded border border-danger bg-danger-lt">
            <div class="severity-label text-uppercase small fw-bold text-danger">Critical</div>
            <div class="severity-count h2 mb-0 text-danger">{{ severity_data.get('critical', 0) }}</div>
          </div>
        </div>
        <div class="col-md-{{ 12 // 5 if severity_data|length >= 5 else 12 // severity_data|length }}">
          <div class="severity-box severity-high text-center p-3 rounded border border-warning bg-warning-lt">
            <div class="severity-label text-uppercase small fw-bold text-warning">High</div>
            <div class="severity-count h2 mb-0 text-warning">{{ severity_data.get('high', 0) }}</div>
          </div>
        </div>
        <div class="col-md-{{ 12 // 5 if severity_data|length >= 5 else 12 // severity_data|length }}">
          <div class="severity-box severity-medium text-center p-3 rounded border border-info bg-info-lt">
            <div class="severity-label text-uppercase small fw-bold text-info">Medium</div>
            <div class="severity-count h2 mb-0 text-info">{{ severity_data.get('medium', 0) }}</div>
          </div>
        </div>
        <div class="col-md-{{ 12 // 5 if severity_data|length >= 5 else 12 // severity_data|length }}">
          <div class="severity-box severity-low text-center p-3 rounded border border-secondary bg-secondary-lt">
            <div class="severity-label text-uppercase small fw-bold text-secondary">Low</div>
            <div class="severity-count h2 mb-0 text-secondary">{{ severity_data.get('low', 0) }}</div>
          </div>
        </div>
        <div class="col-md-{{ 12 // 5 if severity_data|length >= 5 else 12 // severity_data|length }}">
          <div class="severity-box severity-info text-center p-3 rounded border border-light bg-light">
            <div class="severity-label text-uppercase small fw-bold text-muted">Info</div>
            <div class="severity-count h2 mb-0 text-muted">{{ severity_data.get('info', 0) }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Generation Summary -->
  {% if data.generation_summary %}
  <div class="card mb-4">
    <div class="card-header">
      <h3 class="card-title">Generation Summary</h3>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <h4 class="h5 text-muted mb-3">Application Generation</h4>
          <table class="table table-sm table-borderless">
            <tbody>
              <tr>
                <td>Total Apps</td>
                <td class="text-end"><strong>{{ data.generation_summary.total_apps or 0 }}</strong></td>
              </tr>
              <tr>
                <td>Successful</td>
                <td class="text-end"><span class="badge bg-success">{{ data.generation_summary.successful_apps or 0 }}</span></td>
              </tr>
              <tr>
                <td>Failed</td>
                <td class="text-end"><span class="badge bg-danger">{{ data.generation_summary.failed_apps or 0 }}</span></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="col-md-6">
          <h4 class="h5 text-muted mb-3">Analysis Tasks</h4>
          <table class="table table-sm table-borderless">
            <tbody>
              <tr>
                <td>Total Tasks</td>
                <td class="text-end"><strong>{{ data.summary.total_analyses_run or 0 }}</strong></td>
              </tr>
              <tr>
                <td>Completed</td>
                <td class="text-end"><span class="badge bg-success">{{ data.summary.total_analyses_completed or 0 }}</span></td>
              </tr>
              <tr>
                <td>Completion Rate</td>
                <td class="text-end">
                  {% if data.summary.total_analyses_run > 0 %}
                  {{ "%.1f"|format((data.summary.total_analyses_completed / data.summary.total_analyses_run) * 100) }}%
                  {% else %}
                  N/A
                  {% endif %}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Model Statistics -->
  {% if data.model_stats %}
  <div class="card card-table-compact mb-4">
    <div class="card-header">
      <h3 class="card-title">Model Usage Statistics</h3>
    </div>
    <div class="table-responsive">
      <table class="table table-vcenter table-striped card-table">
        <thead>
          <tr>
            <th>Provider</th>
            <th class="text-center">Models</th>
            <th class="text-center">Apps Generated</th>
            <th class="text-center">Success Rate</th>
          </tr>
        </thead>
        <tbody>
          {% for provider, stats in data.model_stats.items() %}
          <tr>
            <td><strong>{{ provider }}</strong></td>
            <td class="text-center">{{ stats.model_count or 0 }}</td>
            <td class="text-center">{{ stats.apps_generated or 0 }}</td>
            <td class="text-center">
              {% if stats.success_rate %}
              <span class="badge bg-{{ 'success' if stats.success_rate >= 80 else 'warning' if stats.success_rate >= 60 else 'danger' }}">
                {{ "%.1f"|format(stats.success_rate) }}%
              </span>
              {% else %}
              N/A
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}

  <!-- Recommendations Section -->
  <div class="card mb-4 border-info">
    <div class="card-header bg-info-lt">
      <h3 class="card-title text-info">
        <i class="fa-solid fa-lightbulb me-2"></i>Key Insights & Recommendations
      </h3>
    </div>
    <div class="card-body">
      <ul class="mb-0">
        {% if data.summary.severity_breakdown %}
          {% set critical = data.summary.severity_breakdown.get('critical', 0) %}
          {% set high = data.summary.severity_breakdown.get('high', 0) %}
          {% if critical > 0 %}
          <li class="mb-2"><strong>Critical Priority:</strong> {{ critical }} critical findings require immediate attention.</li>
          {% endif %}
          {% if high > 0 %}
          <li class="mb-2"><strong>High Priority:</strong> {{ high }} high-severity issues should be addressed soon.</li>
          {% endif %}
          {% if critical == 0 and high == 0 %}
          <li class="mb-2"><strong>Good Status:</strong> No critical or high-severity issues detected.</li>
          {% endif %}
        {% endif %}
        
        {% if data.summary.total_analyses_completed %}
        <li class="mb-2"><strong>Analysis Coverage:</strong> {{ data.summary.total_analyses_completed }} analyses completed across {{ data.summary.total_models or 0 }} AI models.</li>
        {% endif %}
        
        <li><strong>Continuous Monitoring:</strong> Regular analysis runs help maintain code quality and security standards.</li>
      </ul>
    </div>
  </div>

  <!-- Report Footer -->
  <div class="report-footer mt-5 pt-3 border-top text-muted small">
    <div class="row">
      <div class="col-md-6">
        <strong>Report ID:</strong> {{ report.report_id }}<br>
        <strong>Report Type:</strong> Executive Summary
      </div>
      <div class="col-md-6 text-end">
        <strong>Generated:</strong> {{ data.timestamp }}<br>
        <strong>System:</strong> ThesisApp Analysis Platform
      </div>
    </div>
  </div>
</div>
{% endblock %}