{% extends "base.html" %}

{% block title %}AI Models Overview - Thesis Research App{% endblock %}

{% block content %}
<div class="models-overview">
    <!-- Page Header -->
    <header class="page-header">
        <h1>ü§ñ AI Models Overview</h1>
        <p>Comprehensive analysis of {{ summary_stats.total_models }} AI models across {{ summary_stats.total_providers }} providers</p>
    </header>

    <!-- Summary Statistics Cards -->
    <div class="models-summary-grid">
        <div class="stats-card primary">
            <div class="stats-icon">üéØ</div>
            <div class="stats-content">
                <h3>{{ summary_stats.total_models }}</h3>
                <p>Total Models</p>
            </div>
        </div>
        
        <div class="stats-card success">
            <div class="stats-icon">üè¢</div>
            <div class="stats-content">
                <h3>{{ summary_stats.total_providers }}</h3>
                <p>Providers</p>
            </div>
        </div>
        
        <div class="stats-card info">
            <div class="stats-icon">üì±</div>
            <div class="stats-content">
                <h3>{{ summary_stats.total_apps }}</h3>
                <p>Generated Apps</p>
            </div>
        </div>
        
        <div class="stats-card warning">
            <div class="stats-icon">üöÄ</div>
            <div class="stats-content">
                <h3>{{ summary_stats.total_running }}</h3>
                <p>Running Containers</p>
            </div>
        </div>
        
        <div class="stats-card secondary">
            <div class="stats-icon">üëÅÔ∏è</div>
            <div class="stats-content">
                <h3>{{ summary_stats.vision_models }}</h3>
                <p>Vision Models</p>
            </div>
        </div>
        
        <div class="stats-card accent">
            <div class="stats-icon">‚ö°</div>
            <div class="stats-content">
                <h3>{{ summary_stats.function_calling_models }}</h3>
                <p>Function Calling</p>
            </div>
        </div>
        
        <div class="stats-card success">
            <div class="stats-icon">üÜì</div>
            <div class="stats-content">
                <h3>{{ summary_stats.free_models }}</h3>
                <p>Free Models</p>
            </div>
        </div>
        
        <div class="stats-card info">
            <div class="stats-icon">üìä</div>
            <div class="stats-content">
                <h3>{{ "{:,}".format(summary_stats.avg_context_window) }}</h3>
                <p>Avg Context Window</p>
            </div>
        </div>
    </div>

    <!-- Filter and Search Controls -->
    <div class="models-controls">
        <div class="controls-section">
            <div class="search-group">
                <label for="search-input">üîç Search Models</label>
                <input type="search" 
                       id="search-input"
                       name="search"
                       value="{{ search_query }}"
                       hx-get="/models"
                       hx-trigger="keyup changed delay:500ms"
                       hx-target="#models-content"
                       hx-include="[name='provider'], [name='sort']"
                       hx-vals='{"partial": "table"}'
                       placeholder="Search by name, ID, or provider...">
            </div>
            
            <div class="filter-group">
                <label for="provider-filter">üè¢ Provider</label>
                <select id="provider-filter"
                        name="provider"
                        hx-get="/models"
                        hx-trigger="change"
                        hx-target="#models-content"
                        hx-include="[name='search'], [name='sort']"
                        hx-vals='{"partial": "table"}'>
                    <option value="">All Providers ({{ summary_stats.total_providers }})</option>
                    {% for provider in providers %}
                    <option value="{{ provider }}" {% if provider == provider_filter %}selected{% endif %}>
                        {{ provider|title }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="sort-group">
                <label for="sort-select">üìà Sort By</label>
                <select id="sort-select"
                        name="sort"
                        hx-get="/models"
                        hx-trigger="change"
                        hx-target="#models-content"
                        hx-include="[name='search'], [name='provider']"
                        hx-vals='{"partial": "table"}'>
                    <option value="model_name" {% if sort_by == 'model_name' %}selected{% endif %}>Model Name</option>
                    <option value="provider" {% if sort_by == 'provider' %}selected{% endif %}>Provider</option>
                    <option value="context_window" {% if sort_by == 'context_window' %}selected{% endif %}>Context Window</option>
                    <option value="input_price" {% if sort_by == 'input_price' %}selected{% endif %}>Input Price</option>
                    <option value="output_price" {% if sort_by == 'output_price' %}selected{% endif %}>Output Price</option>
                    <option value="safety_score" {% if sort_by == 'safety_score' %}selected{% endif %}>Safety Score</option>
                    <option value="cost_efficiency" {% if sort_by == 'cost_efficiency' %}selected{% endif %}>Cost Efficiency</option>
                </select>
            </div>
            
            <div class="action-group">
                <button class="btn-secondary" onclick="clearFilters()">
                    üóëÔ∏è Clear Filters
                </button>
                <button class="btn-primary" onclick="exportModelsData()">
                    üíæ Export Data
                </button>
            </div>
        </div>
    </div>

    <!-- Models Table -->
    <div id="models-content" class="models-table-container">
        {% include "partials/models_table.html" %}
    </div>
</div>

<!-- Export Modal -->
<div id="export-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Export Models Data</h3>
            <span class="close" onclick="closeModal('export-modal')">&times;</span>
        </div>
        <div class="modal-body">
            <p>Choose export format:</p>
            <div class="export-options">
                <button class="btn-primary" onclick="exportFormat('json')">üìÑ JSON</button>
                <button class="btn-secondary" onclick="exportFormat('csv')">üìä CSV</button>
                <button class="btn-accent" onclick="exportFormat('xlsx')">üìã Excel</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block styles %}
<style>
.models-overview {
    padding: 2rem;
    max-width: 1400px;
    margin: 0 auto;
}

.page-header {
    text-align: center;
    margin-bottom: 3rem;
}

.page-header h1 {
    font-size: 2.5rem;
    color: var(--primary-color);
    margin-bottom: 0.5rem;
}

.page-header p {
    font-size: 1.2rem;
    color: var(--text-muted);
}

.models-summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 3rem;
}

.stats-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border-left: 4px solid var(--primary-color);
    transition: transform 0.2s, box-shadow 0.2s;
}

.stats-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
}

.stats-card.primary { border-left-color: var(--primary-color); }
.stats-card.success { border-left-color: var(--success-color); }
.stats-card.info { border-left-color: var(--info-color); }
.stats-card.warning { border-left-color: var(--warning-color); }
.stats-card.secondary { border-left-color: var(--secondary-color); }
.stats-card.accent { border-left-color: var(--accent-color); }

.stats-icon {
    font-size: 2rem;
    opacity: 0.8;
}

.stats-content h3 {
    font-size: 2rem;
    font-weight: bold;
    margin: 0;
    color: var(--text-primary);
}

.stats-content p {
    margin: 0;
    color: var(--text-muted);
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.models-controls {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.controls-section {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr;
    gap: 1.5rem;
    align-items: end;
}

.search-group, .filter-group, .sort-group, .action-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.search-group label, .filter-group label, .sort-group label {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.9rem;
}

.search-group input, .filter-group select, .sort-group select {
    padding: 0.75rem;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.2s;
}

.search-group input:focus, .filter-group select:focus, .sort-group select:focus {
    outline: none;
    border-color: var(--primary-color);
}

.action-group {
    display: flex;
    flex-direction: row;
    gap: 0.5rem;
}

.models-table-container {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
}

.modal-content {
    background-color: white;
    margin: 15% auto;
    padding: 0;
    border-radius: 12px;
    width: 400px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-color);
}

.modal-header h3 {
    margin: 0;
    color: var(--text-primary);
}

.close {
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--text-muted);
}

.close:hover {
    color: var(--text-primary);
}

.modal-body {
    padding: 1.5rem;
}

.export-options {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-top: 1rem;
}

@media (max-width: 768px) {
    .models-overview {
        padding: 1rem;
    }
    
    .models-summary-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }
    
    .controls-section {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .action-group {
        flex-direction: column;
    }
}
</style>
{% endblock %}

{% block scripts %}
<script>
function clearFilters() {
    document.getElementById('search-input').value = '';
    document.getElementById('provider-filter').value = '';
    document.getElementById('sort-select').value = 'model_name';
    
    // Trigger HTMX update
    htmx.trigger('#search-input', 'keyup');
}

function exportModelsData() {
    document.getElementById('export-modal').style.display = 'block';
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

function exportFormat(format) {
    const searchParams = new URLSearchParams(window.location.search);
    searchParams.set('format', format);
    
    window.open(`/api/models/export?${searchParams.toString()}`, '_blank');
    closeModal('export-modal');
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });
}

// Real-time updates for running containers
setInterval(() => {
    // Update running container counts every 30 seconds
    htmx.trigger('#models-content', 'refresh');
}, 30000);
</script>
{% endblock %}
