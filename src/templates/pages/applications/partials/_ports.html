{# Ports and networking - Compact Layout #}
{% if ports %}
<div class="row g-2">
  <div class="col-12">
    <div class="card card-sm">
      <div class="card-header py-2 d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
          <i class="fas fa-network-wired text-primary me-2"></i>
          <span class="fw-bold">Ports</span>
          <span class="badge bg-secondary-lt ms-2">{{ ports|length }}</span>
        </div>
        <div class="btn-list gap-1">
          <button type="button" class="btn btn-sm btn-ghost-primary py-0" data-port-action="test-all"><i class="fas fa-vial me-1"></i>Test</button>
          <button type="button" class="btn btn-sm btn-ghost-secondary py-0" data-port-action="refresh"><i class="fas fa-sync"></i></button>
        </div>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-sm table-vcenter card-table mb-0">
            <thead><tr><th>Container</th><th>Host</th><th>Proto</th><th>Status</th><th class="text-end">Actions</th></tr></thead>
            <tbody>
              {% for port in ports %}
              <tr>
                <td><code class="small">{{ port.container_port }}</code></td>
                <td><code class="small">{{ port.host_port }}</code></td>
                <td><span class="badge bg-secondary-lt small">{{ port.protocol|upper }}</span></td>
                <td>
                  {% if port.accessible %}<span class="badge bg-success-lt text-success"><i class="fas fa-check"></i></span>
                  {% else %}<span class="badge bg-warning-lt text-warning"><i class="fas fa-times"></i></span>{% endif %}
                </td>
                <td class="text-end">
                  <div class="btn-list justify-content-end gap-1">
                    <button class="btn btn-sm btn-icon btn-ghost-primary py-0" data-port-action="copy" data-port="{{ port.host_port }}" title="Copy"><i class="fas fa-copy"></i></button>
                    <a href="http://localhost:{{ port.host_port }}" target="_blank" class="btn btn-sm btn-icon btn-ghost-info py-0" title="Open"><i class="fas fa-external-link-alt"></i></a>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  const section = document.querySelector('[data-research-section="ports"]');
  if (!section) return;
  section.addEventListener('click', evt => {
    const btn = evt.target.closest('[data-port-action]');
    if (!btn) return;
    const action = btn.dataset.portAction;
    const port = btn.dataset.port;
    if (action === 'copy' && port) {
      navigator.clipboard.writeText(`http://localhost:${port}`).then(() => showToast('Copied', 'success'));
    }
    if (action === 'refresh') {
      htmx.ajax('GET', '/applications/{{ app_data.model_slug }}/{{ app_data.app_number }}/section/ports', { target: '#section-ports', swap: 'innerHTML' });
    }
  });
})();
</script>
{% else %}
<div class="card card-sm">
  <div class="card-body py-4 text-center">
    <i class="fas fa-network-wired text-muted fa-2x mb-2"></i>
    <p class="mb-2 text-muted">No published ports</p>
    {% if app_data.container_status != 'running' %}
    <button class="btn btn-primary btn-sm" onclick="startApplication()"><i class="fas fa-play me-1"></i>Start</button>
    {% endif %}
  </div>
</div>
{% endif %}
