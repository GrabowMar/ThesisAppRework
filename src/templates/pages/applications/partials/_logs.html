{# Application logs - Compact Layout #}
<div class="row g-2">
  {% if logs %}
  {# Controls Row - Compact Inline #}
  <div class="col-12">
    <div class="card card-sm">
      <div class="card-body py-2">
        <div class="d-flex align-items-center flex-wrap gap-2">
          <div class="btn-group btn-group-sm" role="group">
            <button type="button" class="btn btn-primary active" id="btn-backend" onclick="switchContainer('backend')">
              <i class="fas fa-server"></i>
            </button>
            <button type="button" class="btn btn-outline-primary" id="btn-frontend" onclick="switchContainer('frontend')">
              <i class="fas fa-desktop"></i>
            </button>
          </div>
          <select class="form-select form-select-sm" style="width: auto;" id="log-level-filter" onchange="filterLogs()">
            <option value="">All</option>
            <option value="ERROR">Error</option>
            <option value="WARN">Warn</option>
            <option value="INFO">Info</option>
          </select>
          <select class="form-select form-select-sm" style="width: auto;" id="log-lines" onchange="changeLinesCount()">
            <option value="50">50</option>
            <option value="100" selected>100</option>
            <option value="250">250</option>
          </select>
          <input type="text" class="form-control form-control-sm" style="width: 150px;" id="log-search" placeholder="Search..." onkeyup="filterLogs()">
          <div class="btn-group btn-group-sm ms-auto">
            <button class="btn btn-ghost-secondary" hx-get="/applications/{{ app_data.model_slug }}/{{ app_data.app_number }}/section/logs" hx-target="#section-logs" hx-swap="innerHTML" title="Refresh"><i class="fas fa-sync"></i></button>
            <button class="btn btn-ghost-secondary" onclick="toggleAutoRefresh()" id="auto-refresh-btn" title="Auto"><i class="fas fa-pause"></i></button>
            <button class="btn btn-ghost-secondary" onclick="copyLogs()" title="Copy"><i class="fas fa-copy"></i></button>
          </div>
        </div>
      </div>
    </div>
  </div>

  {# Log Display - Compact #}
  <div class="col-12">
    <div class="card card-sm">
      <div class="card-header py-1 d-flex justify-content-between align-items-center">
        <span class="fw-bold small" id="current-container-label">Backend Logs</span>
        <div class="btn-group btn-group-sm">
          <button class="btn btn-ghost-secondary py-0" onclick="scrollToTop()"><i class="fas fa-arrow-up"></i></button>
          <button class="btn btn-ghost-secondary py-0" onclick="scrollToBottom()"><i class="fas fa-arrow-down"></i></button>
        </div>
      </div>
      <div class="card-body p-0">
        <div id="log-container" style="height: 50vh; overflow-y: auto; background: #1e1e2e;">
          <pre id="log-content" class="mb-0 p-2" style="font-size: 0.75rem; line-height: 1.4; font-family: 'Consolas', monospace; color: #cdd6f4;">{{ logs }}</pre>
        </div>
      </div>
    </div>
  </div>

  {# Stats Row - Compact Inline #}
  <div class="col-12">
    <div class="card card-sm">
      <div class="card-body py-2">
        <div class="d-flex align-items-center flex-wrap gap-3">
          <span class="text-muted small"><i class="fas fa-chart-bar me-1"></i>Stats:</span>
          <span class="badge bg-danger-lt" id="error-count"><i class="fas fa-times me-1"></i>{{ log_stats.error_count|default(0) }} Errors</span>
          <span class="badge bg-warning-lt" id="warning-count"><i class="fas fa-exclamation me-1"></i>{{ log_stats.warning_count|default(0) }} Warnings</span>
          <span class="badge bg-info-lt" id="info-count"><i class="fas fa-info me-1"></i>{{ log_stats.info_count|default(0) }} Info</span>
          <span class="badge bg-secondary-lt" id="total-lines"><i class="fas fa-list me-1"></i>{{ log_stats.total_lines|default(0) }} Lines</span>
          <div class="ms-auto btn-list gap-1">
            <a href="/applications/{{ app_data.model_slug }}/{{ app_data.app_number }}/logs/download?format=txt" class="btn btn-sm btn-ghost-primary py-0"><i class="fas fa-download me-1"></i>TXT</a>
            <a href="/applications/{{ app_data.model_slug }}/{{ app_data.app_number }}/logs/download?format=json" class="btn btn-sm btn-ghost-info py-0"><i class="fas fa-code me-1"></i>JSON</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% else %}
  <div class="col-12">
    <div class="card card-sm">
      <div class="card-body py-4 text-center">
        <i class="fas fa-file-lines text-muted fa-2x mb-2"></i>
        <p class="mb-2 text-muted">No logs available</p>
        {% if app_data.container_status != 'running' %}
        <button class="btn btn-primary btn-sm" hx-post="/applications/{{ app_data.model_slug }}/{{ app_data.app_number }}/start" hx-target="#section-container" hx-swap="innerHTML">
          <i class="fas fa-play me-1"></i>Start
        </button>
        {% endif %}
      </div>
    </div>
  </div>
  {% endif %}
</div>

<script>
let autoRefreshInterval, isAutoRefreshing = true, currentContainer = 'backend';
function initLogs() { if (document.getElementById('log-lines')) startAutoRefresh(); }
if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', initLogs); else initLogs();

function switchContainer(type) {
  currentContainer = type;
  document.getElementById('btn-backend').className = type === 'backend' ? 'btn btn-primary active' : 'btn btn-outline-primary';
  document.getElementById('btn-frontend').className = type === 'frontend' ? 'btn btn-primary active' : 'btn btn-outline-primary';
  document.getElementById('current-container-label').textContent = type === 'backend' ? 'Backend Logs' : 'Frontend Logs';
  refreshLogs();
}
function startAutoRefresh() { if (autoRefreshInterval) clearInterval(autoRefreshInterval); autoRefreshInterval = setInterval(() => { if (isAutoRefreshing) refreshLogs(); }, 5000); }
function toggleAutoRefresh() {
  const btn = document.getElementById('auto-refresh-btn'), icon = btn.querySelector('i');
  isAutoRefreshing = !isAutoRefreshing;
  icon.className = isAutoRefreshing ? 'fas fa-pause' : 'fas fa-play';
}
function refreshLogs() {
  const linesEl = document.getElementById('log-lines'); if (!linesEl) return;
  fetch(`/applications/{{ app_data.model_slug }}/{{ app_data.app_number }}/logs/stream?container=${currentContainer}&lines=${linesEl.value}`)
    .then(r => r.text()).then(data => { document.getElementById('log-content').textContent = data; updateLogStats(data); });
}
function filterLogs() {
  const level = document.getElementById('log-level-filter')?.value || '';
  const search = document.getElementById('log-search')?.value || '';
  const params = new URLSearchParams(); params.append('container', currentContainer);
  if (level) params.append('level', level); if (search) params.append('search', search);
  fetch(`/applications/{{ app_data.model_slug }}/{{ app_data.app_number }}/logs/filter?${params}`)
    .then(r => r.text()).then(data => { document.getElementById('log-content').textContent = data; updateLogStats(data); });
}
function changeLinesCount() { refreshLogs(); }
function scrollToTop() { document.getElementById('log-container').scrollTop = 0; }
function scrollToBottom() { const c = document.getElementById('log-container'); c.scrollTop = c.scrollHeight; }
function copyLogs() { navigator.clipboard.writeText(document.getElementById('log-content').textContent).then(() => showToast('Copied', 'success')); }
function updateLogStats(content) {
  const lines = content.split('\n').filter(l => l.trim());
  document.getElementById('error-count').innerHTML = `<i class="fas fa-times me-1"></i>${lines.filter(l => l.includes('ERROR')).length} Errors`;
  document.getElementById('warning-count').innerHTML = `<i class="fas fa-exclamation me-1"></i>${lines.filter(l => l.includes('WARN')).length} Warnings`;
  document.getElementById('info-count').innerHTML = `<i class="fas fa-info me-1"></i>${lines.filter(l => l.includes('INFO')).length} Info`;
  document.getElementById('total-lines').innerHTML = `<i class="fas fa-list me-1"></i>${lines.length} Lines`;
}
window.addEventListener('beforeunload', () => { if (autoRefreshInterval) clearInterval(autoRefreshInterval); });
</script>

