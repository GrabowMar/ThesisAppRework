{# Application metadata - Compact Layout #}
<div class="row g-2">
  {# Combined App Info & Generation Details #}
  <div class="col-12">
    <div class="card card-sm shadow-sm">
      <div class="card-header py-2 d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
          <i class="fas fa-database text-primary me-2"></i>
          <span class="fw-bold">Metadata</span>
        </div>
        <button class="btn btn-ghost-secondary btn-sm py-0" 
                hx-get="/applications/{{ app_data.model_slug }}/{{ app_data.app_number }}/section/metadata"
                hx-target="#section-metadata" hx-swap="innerHTML" title="Refresh">
          <i class="fas fa-sync"></i>
        </button>
      </div>
      <div class="card-body py-2">
        <div class="row g-3">
          {# App Info Column #}
          <div class="col-md-6">
            <div class="d-flex align-items-center mb-2">
              <i class="fas fa-info-circle text-info me-2"></i>
              <span class="text-muted small text-uppercase fw-bold">Application</span>
            </div>
            <div class="row row-cols-2 g-2 small">
              <div class="col"><span class="text-muted">Model:</span> <span class="fw-medium">{{ app_data.model_slug }}</span></div>
              <div class="col"><span class="text-muted">Provider:</span> <span class="badge bg-primary-lt text-primary">{{ app_data.provider or model.provider }}</span></div>
              <div class="col"><span class="text-muted">Number:</span> <span class="fw-medium">#{{ app_data.app_number }}</span></div>
              <div class="col"><span class="text-muted">Type:</span> <span class="fw-medium">{{ app_data.app_type|default('unknown') }}</span></div>
              <div class="col"><span class="text-muted">Created:</span> <span class="fw-medium">{% if app_data.created_at %}{{ app_data.created_at.strftime('%m/%d %H:%M') }}{% else %}—{% endif %}</span></div>
              <div class="col"><span class="text-muted">Updated:</span> <span class="fw-medium">{% if app_data.updated_at %}{{ app_data.updated_at.strftime('%m/%d %H:%M') }}{% else %}—{% endif %}</span></div>
            </div>
          </div>
          {# Generation Details Column #}
          <div class="col-md-6">
            <div class="d-flex align-items-center mb-2">
              <i class="fas fa-cogs text-success me-2"></i>
              <span class="text-muted small text-uppercase fw-bold">Generation</span>
            </div>
            <div class="row row-cols-2 g-2 small">
              <div class="col"><span class="text-muted">Backend:</span> {% if app_data.backend_framework %}<span class="badge bg-success-lt">{{ app_data.backend_framework }}</span>{% else %}<span class="text-muted">—</span>{% endif %}</div>
              <div class="col"><span class="text-muted">Frontend:</span> {% if app_data.frontend_framework %}<span class="badge bg-info-lt">{{ app_data.frontend_framework }}</span>{% else %}<span class="text-muted">—</span>{% endif %}</div>
              <div class="col"><span class="text-muted">Database:</span> {% if app_data.database_type %}<span class="badge bg-warning-lt">{{ app_data.database_type }}</span>{% else %}<span class="text-muted">—</span>{% endif %}</div>
              <div class="col"><span class="text-muted">Duration:</span> <span class="fw-medium">{% if app_data.generation_duration %}{{ app_data.generation_duration }}s{% else %}—{% endif %}</span></div>
              <div class="col"><span class="text-muted">Template:</span> {% if app_data.prompt_template %}<code class="small">{{ app_data.prompt_template }}</code>{% else %}<span class="text-muted">—</span>{% endif %}</div>
              <div class="col"><span class="text-muted">Tokens:</span> <span class="fw-medium">{% if app_data.token_usage %}{{ app_data.token_usage }}{% else %}—{% endif %}</span></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  {# Environment Variables - Compact #}
  {% if environment_variables %}
  <div class="col-12">
    <div class="card card-sm shadow-sm">
      <div class="card-header py-2">
        <div class="d-flex align-items-center">
          <i class="fas fa-key text-warning me-2"></i>
          <span class="fw-bold">Environment</span>
          <span class="badge bg-secondary-lt ms-2">{{ environment_variables|length }}</span>
        </div>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-sm card-table mb-0">
            <thead><tr><th>Variable</th><th>Value</th><th>Source</th></tr></thead>
            <tbody>
              {% for var in environment_variables[:8] %}
              <tr>
                <td><code class="small">{{ var.name }}</code></td>
                <td>
                  {% if var.is_secret %}<span class="text-muted">••••</span>
                  {% else %}<code class="small">{{ var.value|truncate(30) }}</code>{% endif %}
                </td>
                <td><span class="badge bg-{{ 'warning' if var.source == 'dockerfile' else ('info' if var.source == 'compose' else 'secondary') }}-lt small">{{ var.source|title }}</span></td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% if environment_variables|length > 8 %}
        <div class="text-center py-1 border-top"><span class="text-muted small">+{{ environment_variables|length - 8 }} more</span></div>
        {% endif %}
      </div>
    </div>
  </div>
  {% endif %}

  {# Dependencies - Compact #}
  {% if dependencies %}
  <div class="col-12">
    <div class="card card-sm shadow-sm">
      <div class="card-header py-2">
        <div class="d-flex align-items-center">
          <i class="fas fa-box text-purple me-2"></i>
          <span class="fw-bold">Dependencies</span>
        </div>
      </div>
      <div class="card-body py-2">
        <div class="row g-2">
          {% for dep_type, deps in dependencies.items() %}
          <div class="col-md-6">
            <div class="d-flex align-items-center mb-1">
              <span class="text-muted small text-uppercase fw-bold">{{ dep_type|title }}</span>
              <span class="badge bg-secondary-lt ms-2 small">{{ deps|length }}</span>
            </div>
            <div class="d-flex flex-wrap gap-1">
              {% for dep in deps[:6] %}
              <span class="badge bg-secondary-lt small">{{ dep.name }} {{ dep.version|default('') }}</span>
              {% endfor %}
              {% if deps|length > 6 %}<span class="badge bg-secondary-lt small">+{{ deps|length - 6 }}</span>{% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  {# Config Files - Compact #}
  {% if config_files %}
  <div class="col-12">
    <div class="card card-sm shadow-sm">
      <div class="card-header py-2">
        <div class="d-flex align-items-center">
          <i class="fas fa-file-code text-cyan me-2"></i>
          <span class="fw-bold">Config Files</span>
          <span class="badge bg-secondary-lt ms-2">{{ config_files|length }}</span>
        </div>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-sm card-table mb-0">
            <thead><tr><th>File</th><th>Type</th><th>Size</th><th class="text-end">Actions</th></tr></thead>
            <tbody>
              {% for file in config_files[:6] %}
              <tr>
                <td><code class="small">{{ file.name }}</code></td>
                <td><span class="badge bg-info-lt small">{{ file.type|default('config') }}</span></td>
                <td class="small">{{ file.size|default('—') }}</td>
                <td class="text-end">
                  <button class="btn btn-ghost-primary btn-sm py-0" onclick="viewConfigFile('{{ file.path }}')" title="View"><i class="fas fa-eye"></i></button>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</div>

<div class="modal fade" id="configFileModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header py-2"><h6 class="modal-title">Config File</h6><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body"><div id="config-file-content"></div></div>
    </div>
  </div>
</div>

<script>
function viewConfigFile(filePath) {
  htmx.ajax('GET', `/applications/{{ app_data.model_slug }}/{{ app_data.app_number }}/config-file?path=${encodeURIComponent(filePath)}`, {
    target: '#config-file-content', swap: 'innerHTML'
  });
  new bootstrap.Modal(document.getElementById('configFileModal')).show();
}
</script>
