{# Application overview - identity, lifecycle, code metrics #}
<div class="row g-3">
  <div class="col-md-4">
    <div class="card card-sm">
      <div class="card-body">
        <div class="d-flex align-items-center mb-3">
          <div class="me-2">
            <i class="fas fa-id-badge text-primary" aria-hidden="true"></i>
          </div>
          <h3 class="card-title mb-0">Identity</h3>
        </div>
        <div class="datagrid">
          <div class="datagrid-item">
            <div class="datagrid-title">Model</div>
            <div class="datagrid-content">{{ app_data.model_slug }}</div>
          </div>
          <div class="datagrid-item">
            <div class="datagrid-title">Provider</div>
            <div class="datagrid-content">
              <span class="badge bg-primary-lt text-primary">{{ app_data.provider or model.provider }}</span>
            </div>
          </div>
          <div class="datagrid-item">
            <div class="datagrid-title">Application</div>
            <div class="datagrid-content">#{{ app_data.app_number }} · {{ app_data.app_type|default('unknown')|replace('_', ' ')|title }}</div>
          </div>
          <div class="datagrid-item">
            <div class="datagrid-title">Created</div>
            <div class="datagrid-content">
              {% if app_data.created_at %}
                {{ app_data.created_at.strftime('%Y-%m-%d %H:%M') }}
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </div>
          </div>
          <div class="datagrid-item">
            <div class="datagrid-title">Frameworks</div>
            <div class="datagrid-content">
              {% if app_data.backend_framework or app_data.frontend_framework %}
                <div class="d-flex flex-wrap gap-1">
                  {% if app_data.backend_framework %}
                    <span class="badge bg-success-lt">
                      <i class="fas fa-server me-1" aria-hidden="true"></i>{{ app_data.backend_framework }}
                    </span>
                  {% endif %}
                  {% if app_data.frontend_framework %}
                    <span class="badge bg-info-lt">
                      <i class="fas fa-desktop me-1" aria-hidden="true"></i>{{ app_data.frontend_framework }}
                    </span>
                  {% endif %}
                </div>
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card card-sm">
      <div class="card-body">
        <div class="d-flex align-items-center mb-3">
          <div class="me-2">
            <i class="fas fa-life-ring text-success" aria-hidden="true"></i>
          </div>
          <h3 class="card-title mb-0">Lifecycle</h3>
        </div>
        <div class="mb-3">
          <div class="text-muted small text-uppercase">Container</div>
          <div class="h3 mb-0 {{ 'text-success' if app_data.container_status == 'running' else ('text-warning' if app_data.container_status == 'building' else 'text-muted') }}">
            {{ app_data.container_status|default('unknown')|replace('_', ' ')|title }}
          </div>
          <div class="small text-muted">Last updated {{ app_data.updated_at.strftime('%Y-%m-%d %H:%M') if app_data.updated_at else '—' }}</div>
        </div>
        <div class="datagrid">
          <div class="datagrid-item">
            <div class="datagrid-title">Ports</div>
            <div class="datagrid-content">{{ app_data.ports|length }}</div>
          </div>
          <div class="datagrid-item">
            <div class="datagrid-title">Generation Status</div>
            <div class="datagrid-content">{{ app_data.generation_status|default('unknown')|replace('_', ' ')|title }}</div>
          </div>
          <div class="datagrid-item">
            <div class="datagrid-title">Project Directory</div>
            <div class="datagrid-content text-truncate" title="{{ app_base_dir }}">{{ app_base_dir }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card card-sm">
      <div class="card-body">
        <div class="d-flex align-items-center mb-3">
          <div class="me-2">
            <i class="fas fa-chart-bar text-info"></i>
          </div>
          <h3 class="card-title mb-0">Code Footprint</h3>
        </div>
        <div class="row g-2 mb-3">
          <div class="col-6">
            <div class="text-muted small text-uppercase">Total Lines</div>
            <div class="h3 mb-0 text-primary">{{ code_stats.total_loc }}</div>
            <div class="small text-muted">Across generated files</div>
          </div>
          <div class="col-6">
            <div class="text-muted small text-uppercase">Files</div>
            <div class="h3 mb-0 text-success">{{ code_stats.total_files }}</div>
            <div class="small text-muted">Tracked in snapshot</div>
          </div>
        </div>
        {% if code_stats.by_language %}
          <div class="row g-1">
            {% for lang, data in code_stats.by_language.items() %}
              <div class="col-6">
                <div class="d-flex justify-content-between align-items-center p-2 bg-light rounded">
                  <span class="small fw-semibold text-muted">{{ lang }}</span>
                  <span class="small fw-bold">{{ data.loc }} LOC</span>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted small mb-0">Code statistics will appear after the first analysis.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-12">
    <div class="card card-sm">
      <div class="card-body">
        <div class="d-flex align-items-center mb-3">
          <div class="me-2">
            <i class="fas fa-bolt text-warning"></i>
          </div>
          <h3 class="card-title mb-0">Highlights</h3>
        </div>
        <div class="d-flex flex-wrap gap-2">
          <span class="badge bg-secondary-lt">
            <i class="fas fa-layer-group me-1"></i>{{ model.apps_count }} sibling apps for this model
          </span>
          <span class="badge bg-secondary-lt">
            <i class="fas fa-clock me-1"></i>Last check {{ app_data.last_status_check.strftime('%Y-%m-%d %H:%M') if app_data.last_status_check else '—' }}
          </span>
          {% if app_data.has_docker_compose %}
            <span class="badge bg-success-lt">
              <i class="fas fa-cubes me-1"></i>Docker Compose Ready
            </span>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="col-12">
    <div class="card card-sm">
      <div class="card-body">
          <div class="d-flex align-items-center justify-content-between mb-3">
          <div class="d-flex align-items-center">
            <div class="me-2">
              <i class="fas fa-terminal text-info"></i>
            </div>
            <h3 class="card-title mb-0">Generation Artifacts</h3>
          </div>
          <button class="btn btn-ghost-primary btn-sm" onclick="openPromptsModal()">
            <i class="fas fa-eye me-1"></i>View Prompts
          </button>
        </div>
        <div class="row g-2">
          <div class="col-md-6">
            <div class="list-group list-group-flush">
              <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                <div>
                  <i class="fas fa-file-code me-2 text-success"></i>
                  <strong>Backend Prompt</strong>
                  {% if template_files.backend_file %}
                    <div class="text-muted small">{{ template_files.backend_file }}</div>
                  {% endif %}
                </div>
                <span class="badge {{ 'bg-success-lt text-success' if prompts.backend else 'bg-secondary-lt text-secondary' }}">
                  {{ 'Available' if prompts.backend else 'Not found' }}
                </span>
              </div>
              <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                <div>
                  <i class="fas fa-file-code me-2 text-info"></i>
                  <strong>Frontend Prompt</strong>
                  {% if template_files.frontend_file %}
                    <div class="text-muted small">{{ template_files.frontend_file }}</div>
                  {% endif %}
                </div>
                <span class="badge {{ 'bg-success-lt text-success' if prompts.frontend else 'bg-secondary-lt text-secondary' }}">
                  {{ 'Available' if prompts.frontend else 'Not found' }}
                </span>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="list-group list-group-flush">
              <a href="/applications/{{ app_data.model_slug }}/{{ app_data.app_number }}/generation-metadata" 
                 class="list-group-item list-group-item-action d-flex justify-content-between align-items-center px-0"
                 target="_blank">
                <div>
                  <i class="fas fa-database me-2 text-primary"></i>
                  <strong>Backend Metadata</strong>
                  <div class="text-muted small">Generation details & metrics</div>
                </div>
                <i class="fas fa-external-link-alt text-muted"></i>
              </a>
              <a href="/applications/{{ app_data.model_slug }}/{{ app_data.app_number }}/generation-metadata" 
                 class="list-group-item list-group-item-action d-flex justify-content-between align-items-center px-0"
                 target="_blank">
                <div>
                  <i class="fas fa-database me-2 text-warning"></i>
                  <strong>Frontend Metadata</strong>
                  <div class="text-muted small">Generation details & metrics</div>
                </div>
                <i class="fas fa-external-link-alt text-muted"></i>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
