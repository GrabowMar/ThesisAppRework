{% set status = app_data.container_status|default('unknown') %}
{% set status_label = status|replace('_', ' ')|title %}
{% set status_color = 'success' if status == 'running' else ('warning' if status in ['building', 'starting'] else 'secondary') %}

{# Container management - Compact layout #}
<div id="container-management-section" 
     data-model-slug="{{ app_data.model_slug }}" 
     data-app-number="{{ app_data.app_number }}"
     class="row g-2">
  
  {# Status & Runtime - Combined #}
  <div class="col-lg-6">
    <div class="card card-sm h-100">
      <div class="card-status-top bg-{{ status_color }}"></div>
      <div class="card-body py-2">
        <div class="row g-3">
          {# Status Column #}
          <div class="col-md-6">
            <div class="d-flex align-items-center mb-2">
              <i class="fas fa-heartbeat text-{{ status_color }} me-2"></i>
              <span class="text-muted small text-uppercase fw-bold">Status</span>
            </div>
            <div class="d-flex align-items-center gap-2 mb-2">
              <span class="status-dot {% if status == 'running' %}status-dot-animated{% endif %} status-{{ status_color }}"></span>
              <span class="h4 mb-0">{{ status_label }}</span>
            </div>
            <div class="row row-cols-2 g-1 small">
              <div class="col">
                <span class="text-muted">Updated:</span>
                <span class="fw-medium">{{ app_data.updated_at.strftime('%m/%d %H:%M') if app_data.updated_at else '—' }}</span>
              </div>
              <div class="col">
                <span class="text-muted">ID:</span>
                <code class="small">{{ (app_data.container_id[:8]) if app_data.container_id else 'n/a' }}</code>
              </div>
            </div>
          </div>
          {# Runtime Column #}
          <div class="col-md-6">
            <div class="d-flex align-items-center mb-2">
              <i class="fas fa-info-circle text-info me-2"></i>
              <span class="text-muted small text-uppercase fw-bold">Runtime</span>
            </div>
            <div class="row row-cols-2 g-1 small">
              <div class="col"><span class="text-muted">Compose:</span></div>
              <div class="col text-end">
                {% if app_data.has_docker_compose %}<span class="badge bg-success-lt">Yes</span>
                {% else %}<span class="badge bg-secondary-lt">No</span>{% endif %}
              </div>
              <div class="col"><span class="text-muted">Ports:</span></div>
              <div class="col text-end fw-medium">{{ app_data.ports|length }}</div>
            </div>
            {% if app_data.ports %}
            <div class="d-flex flex-wrap gap-1 mt-2">
              {% for port in app_data.ports[:3] %}
                <span class="badge bg-primary-lt text-primary small">{{ port }}</span>
              {% endfor %}
              {% if app_data.ports|length > 3 %}<span class="badge bg-secondary-lt small">+{{ app_data.ports|length - 3 }}</span>{% endif %}
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  {# Controls - Compact #}
  <div class="col-lg-3">
    <div class="card card-sm h-100">
      <div class="card-body py-2">
        <div class="d-flex align-items-center mb-2">
          <i class="fas fa-gamepad text-purple me-2"></i>
          <span class="text-muted small text-uppercase fw-bold">Controls</span>
        </div>
        <div class="d-flex flex-wrap gap-1">
          {% if status == 'running' %}
            <button type="button" id="btn-container-stop" class="btn btn-sm btn-danger py-1">
              <i class="fas fa-stop me-1"></i>Stop
            </button>
          {% else %}
            <button type="button" id="btn-container-start" class="btn btn-sm btn-success py-1">
              <i class="fas fa-play me-1"></i>Start
            </button>
          {% endif %}
          <button type="button" id="btn-container-restart" class="btn btn-sm btn-warning py-1">
            <i class="fas fa-rotate me-1"></i>Restart
          </button>
          {% if app_data.has_docker_compose %}
            <button type="button" id="btn-container-build" class="btn btn-sm btn-primary py-1">
              <i class="fas fa-hammer me-1"></i>Build
            </button>
          {% endif %}
        </div>
        <div class="d-flex flex-wrap gap-1 mt-2">
          <button type="button" id="btn-diagnostics-refresh" class="btn btn-sm btn-ghost-secondary py-1">
            <i class="fas fa-sync me-1"></i>Refresh
          </button>
          <button type="button" id="btn-logs-refresh" class="btn btn-sm btn-ghost-secondary py-1">
            <i class="fas fa-file-lines me-1"></i>Logs
          </button>
        </div>
      </div>
    </div>
  </div>

  {# Logs Preview - Compact #}
  <div class="col-lg-3">
    <div class="card card-sm h-100">
      <div class="card-body py-2">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <div class="d-flex align-items-center">
            <i class="fas fa-terminal text-cyan me-2"></i>
            <span class="text-muted small text-uppercase fw-bold">Logs</span>
          </div>
          <button class="btn btn-sm btn-ghost-secondary py-0" id="btn-logs-download" title="Download">
            <i class="fas fa-download"></i>
          </button>
        </div>
        <div id="logs-panel">
          {% if container_logs %}
            <pre class="bg-dark text-white rounded p-2 small mb-0" style="max-height: 5rem; overflow:auto; font-size: 0.7rem;">{{ container_logs|trim|truncate(180, True, '…') }}</pre>
          {% else %}
            <div class="text-muted small text-center py-2">
              <i class="fas fa-info-circle me-1"></i>No logs yet
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
