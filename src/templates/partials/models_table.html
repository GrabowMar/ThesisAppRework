<!-- Models Table - Bootstrap 4.1 with HTMX -->
<div class="table-responsive">
    <table class="table table-hover mb-0">
        <thead class="thead-dark">
            <tr>
                <th scope="col">
                    <i class="fas fa-robot mr-1"></i>Model
                </th>
                <th scope="col">
                    <i class="fas fa-building mr-1"></i>Provider
                </th>
                <th scope="col">
                    <i class="fas fa-memory mr-1"></i>Context
                </th>
                <th scope="col">
                    <i class="fas fa-dollar-sign mr-1"></i>Pricing
                </th>
                <th scope="col">
                    <i class="fas fa-cogs mr-1"></i>Features
                </th>
                <th scope="col">
                    <i class="fas fa-chart-line mr-1"></i>Quality
                </th>
                <th scope="col">
                    <i class="fas fa-rocket mr-1"></i>Status
                </th>
                <th scope="col">
                    <i class="fas fa-tools mr-1"></i>Actions
                </th>
            </tr>
        </thead>
        <tbody>
            {% for model in models %}
            <tr id="model-row-{{ model.canonical_slug }}">
                <td>
                    <div class="d-flex align-items-center">
                        <div class="mr-2">
                            {% if model.supports_vision %}
                            <i class="fas fa-eye text-info" data-toggle="tooltip" title="Vision Support"></i>
                            {% else %}
                            <i class="fas fa-brain text-muted" data-toggle="tooltip" title="Text Only"></i>
                            {% endif %}
                        </div>
                        <div>
                            <div class="font-weight-bold">{{ model.model_name }}</div>
                            <small class="text-muted">{{ model.model_id or model.canonical_slug }}</small>
                            {% if model.is_free %}
                            <span class="badge badge-success badge-sm ml-1">FREE</span>
                            {% endif %}
                        </div>
                    </div>
                </td>
                <td>
                    <span class="badge badge-primary">{{ model.provider }}</span>
                    {% if model.architecture and model.architecture.parameter_count and model.architecture.parameter_count != 'unknown' %}
                    <small class="text-muted d-block">{{ model.architecture.parameter_count }}</small>
                    {% endif %}
                </td>
                <td>
                    <div class="text-center">
                        <span class="font-weight-bold">{{ "{:,}".format(model.context_window) if model.context_window else 'N/A' }}</span>
                        {% if model.context_window %}
                        <small class="text-muted d-block">tokens</small>
                        {% endif %}
                        {% if model.max_output_tokens %}
                        <small class="text-info d-block">Out: {{ "{:,}".format(model.max_output_tokens) }}</small>
                        {% endif %}
                    </div>
                </td>
                <td>
                    {% if model.is_free %}
                    <div class="text-center">
                        <span class="badge badge-success">FREE</span>
                    </div>
                    {% else %}
                    <div class="text-center">
                        <div class="text-success small">
                            {% if model.input_price_per_token and model.input_price_per_token > 0 %}
                            In: ${{ "%.6f"|format(model.input_price_per_token) }}
                            {% else %}
                            In: N/A
                            {% endif %}
                        </div>
                        <div class="text-warning small">
                            {% if model.output_price_per_token and model.output_price_per_token > 0 %}
                            Out: ${{ "%.6f"|format(model.output_price_per_token) }}
                            {% else %}
                            Out: N/A
                            {% endif %}
                        </div>
                        {% if model.cost_efficiency and model.cost_efficiency > 0 %}
                        <small class="text-muted">Eff: {{ "%.2f"|format(model.cost_efficiency) }}</small>
                        {% endif %}
                    </div>
                    {% endif %}
                </td>
                <td>
                    <div class="d-flex flex-wrap">
                        {% if model.supports_function_calling %}
                        <span class="badge badge-success badge-sm mr-1 mb-1">
                            <i class="fas fa-cog mr-1"></i>Functions
                        </span>
                        {% endif %}
                        {% if model.supports_vision %}
                        <span class="badge badge-info badge-sm mr-1 mb-1">
                            <i class="fas fa-eye mr-1"></i>Vision
                        </span>
                        {% endif %}
                        {% if model.supports_json_mode %}
                        <span class="badge badge-secondary badge-sm mr-1 mb-1">
                            <i class="fas fa-code mr-1"></i>JSON
                        </span>
                        {% endif %}
                        {% if model.supports_streaming %}
                        <span class="badge badge-dark badge-sm mr-1 mb-1">
                            <i class="fas fa-stream mr-1"></i>Stream
                        </span>
                        {% endif %}
                        {% if model.context_window and model.context_window > 100000 %}
                        <span class="badge badge-warning badge-sm mr-1 mb-1">
                            <i class="fas fa-expand-arrows-alt mr-1"></i>Long
                        </span>
                        {% endif %}
                    </div>
                </td>
                <td>
                    {% if model.quality_metrics or model.safety_score %}
                    <div class="text-center">
                        {% if model.quality_metrics %}
                        {% if model.quality_metrics.helpfulness %}
                        <div class="text-primary small">Help: {{ "%.1f"|format(model.quality_metrics.helpfulness) }}</div>
                        {% endif %}
                        {% if model.quality_metrics.accuracy %}
                        <div class="text-info small">Acc: {{ "%.1f"|format(model.quality_metrics.accuracy) }}</div>
                        {% endif %}
                        {% if model.quality_metrics.safety %}
                        <div class="text-success small">Safe: {{ "%.1f"|format(model.quality_metrics.safety) }}</div>
                        {% endif %}
                        {% endif %}
                        {% if model.safety_score and model.safety_score > 0 %}
                        <div class="font-weight-bold">{{ "%.1f"|format(model.safety_score) }}</div>
                        {% endif %}
                    </div>
                    {% else %}
                    <span class="text-muted">N/A</span>
                    {% endif %}
                </td>
                <td>
                    <div class="text-center">
                        <div class="d-flex align-items-center justify-content-center">
                            <div class="mr-2">
                                <span class="badge badge-success">{{ model.running_containers or 0 }}</span>
                                <small class="text-muted d-block">Running</small>
                            </div>
                            <div>
                                <span class="badge badge-secondary">{{ model.stopped_containers or (30 - (model.running_containers or 0)) }}</span>
                                <small class="text-muted d-block">Stopped</small>
                            </div>
                        </div>
                        {% if model.running_containers and model.running_containers > 0 %}
                        <i class="fas fa-circle text-success status-circle" data-toggle="tooltip" title="Active containers"></i>
                        {% else %}
                        <i class="fas fa-circle text-muted status-circle" data-toggle="tooltip" title="No active containers"></i>
                        {% endif %}
                    </div>
                </td>
                <td>
                    <div class="btn-group btn-group-sm" role="group">
                        <button type="button" class="btn btn-outline-info"
                                onclick="showModelDetails('{{ model.canonical_slug }}')"
                                data-toggle="tooltip" title="View Details">
                            <i class="fas fa-info-circle"></i>
                        </button>
                        <button type="button" class="btn btn-outline-success"
                                hx-post="/api/model/{{ model.canonical_slug }}/start-all"
                                hx-target="#model-row-{{ model.canonical_slug }}"
                                hx-swap="outerHTML"
                                hx-confirm="Start all containers for {{ model.model_name }}?"
                                data-toggle="tooltip" title="Start All">
                            <i class="fas fa-play"></i>
                        </button>
                        <button type="button" class="btn btn-outline-danger"
                                hx-post="/api/model/{{ model.canonical_slug }}/stop-all"
                                hx-target="#model-row-{{ model.canonical_slug }}"
                                hx-swap="outerHTML"
                                hx-confirm="Stop all containers for {{ model.model_name }}?"
                                data-toggle="tooltip" title="Stop All">
                            <i class="fas fa-stop"></i>
                        </button>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="/analysis/{{ model.canonical_slug }}">
                                    <i class="fas fa-shield-alt mr-2"></i>Security Analysis
                                </a>
                                <a class="dropdown-item" href="/performance/{{ model.canonical_slug }}">
                                    <i class="fas fa-tachometer-alt mr-2"></i>Performance Test
                                </a>
                                <a class="dropdown-item" href="/models/{{ model.canonical_slug }}/apps">
                                    <i class="fas fa-th-large mr-2"></i>View Applications
                                </a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#" onclick="exportModelData('{{ model.canonical_slug }}')">
                                    <i class="fas fa-download mr-2"></i>Export Data
                                </a>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- No Results State -->
{% if not models %}
<div class="text-center py-5">
    <i class="fas fa-search fa-3x text-muted mb-3"></i>
    <h4 class="text-muted">No Models Found</h4>
    <p class="text-muted">No models match your current search criteria.</p>
    <button class="btn btn-primary" onclick="clearFilters()">
        <i class="fas fa-times mr-2"></i>Clear Filters
    </button>
</div>
{% endif %}

<!-- Pagination -->
{% if pagination %}
<div class="d-flex justify-content-between align-items-center p-3 border-top">
    <div class="text-muted">
        Showing {{ pagination.start }} to {{ pagination.end }} of {{ pagination.total }} models
    </div>
    <nav aria-label="Models pagination">
        <ul class="pagination pagination-sm mb-0">
            <!-- Previous Page -->
            <li class="page-item {{ 'disabled' if not pagination.has_prev }}">
                <a class="page-link" 
                   href="#"
                   hx-get="/models"
                   hx-target="#models-content"
                   hx-include="[name='search'], [name='provider'], [name='sort']"
                   hx-vals='{"partial": "table", "page": {{ pagination.prev_num if pagination.has_prev else 1 }}}'>
                    <i class="fas fa-chevron-left"></i>
                </a>
            </li>
            
            <!-- Page Numbers -->
            {% for page_num in pagination.iter_pages() %}
                {% if page_num %}
                <li class="page-item {{ 'active' if page_num == pagination.page }}">
                    <a class="page-link" 
                       href="#"
                       hx-get="/models"
                       hx-target="#models-content"
                       hx-include="[name='search'], [name='provider'], [name='sort']"
                       hx-vals='{"partial": "table", "page": {{ page_num }}}'>
                        {{ page_num }}
                    </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <span class="page-link">…</span>
                </li>
                {% endif %}
            {% endfor %}
            
            <!-- Next Page -->
            <li class="page-item {{ 'disabled' if not pagination.has_next }}">
                <a class="page-link" 
                   href="#"
                   hx-get="/models"
                   hx-target="#models-content"
                   hx-include="[name='search'], [name='provider'], [name='sort']"
                   hx-vals='{"partial": "table", "page": {{ pagination.next_num if pagination.has_next else pagination.pages }}}'>
                    <i class="fas fa-chevron-right"></i>
                </a>
            </li>
        </ul>
    </nav>
</div>
{% endif %}

<!-- Table Summary Footer -->
{% if models %}
<div class="d-flex justify-content-between align-items-center p-3 bg-light border-top">
    <div class="text-muted">
        <i class="fas fa-info-circle mr-1"></i>
        Showing {{ models|length }} models
        {% if search_query or provider_filter %}
        <span class="badge badge-secondary ml-1">Filtered</span>
        {% endif %}
    </div>
    
    <div class="btn-group btn-group-sm">
        <button type="button" class="btn btn-outline-secondary" onclick="selectAllModels()">
            <i class="fas fa-check-square mr-1"></i>Select All
        </button>
        <button type="button" class="btn btn-outline-primary" onclick="compareSelectedModels()">
            <i class="fas fa-balance-scale mr-1"></i>Compare
        </button>
        <button type="button" class="btn btn-outline-success" onclick="bulkExportModels()">
            <i class="fas fa-download mr-1"></i>Export All
        </button>
    </div>
</div>
{% endif %}

<script>
function showModelDetails(modelSlug) {
    // Load model details into modal
    htmx.ajax('GET', `/api/model/${modelSlug}/details`, {
        target: '#model-details-modal .modal-body',
        swap: 'innerHTML'
    });
    
    // Show modal
    $('#model-details-modal').modal('show');
}

function exportModelData(modelSlug) {
    window.open(`/api/models/${modelSlug}/export`, '_blank');
}

function selectAllModels() {
    // Implementation for selecting all models
    console.log('Select all models');
}

function compareSelectedModels() {
    // Implementation for model comparison
    console.log('Compare selected models');
}

function bulkExportModels() {
    // Implementation for bulk export
    window.open('/api/models/export?format=xlsx', '_blank');
}

// Initialize tooltips for table
$(document).ready(function() {
    $('[data-toggle="tooltip"]').tooltip();
});
</script>

