<div class="file-tree-container">
    <div class="d-flex justify-content-between align-items-center mb-2 px-3 py-2 bg-light">
        <small class="text-muted">
            <i class="fas fa-folder mr-1"></i>
            {{ total_files }} files
        </small>
        <button class="btn btn-sm btn-outline-secondary" onclick="expandAllFolders()">
            <i class="fas fa-expand-arrows-alt mr-1"></i>
            Expand All
        </button>
    </div>
    
    <div class="list-group list-group-flush file-tree">
        {% for item in files %}
            {% if item.type == 'directory' %}
                <div class="list-group-item folder-item file-tree-item" data-toggle="collapse" data-target="#folder-{{ loop.index }}" style="--level: {{ item.level }}">
                    <i class="fas fa-folder text-warning mr-2"></i>
                    <span class="folder-name">{{ item.name }}</span>
                    <i class="fas fa-chevron-right float-right folder-chevron"></i>
                </div>
                <div class="collapse" id="folder-{{ loop.index }}">
                    {% for child in item.children %}
                        {% if child.type == 'file' %}
                            <a href="javascript:void(0)" 
                               class="list-group-item list-group-item-action file-item file-tree-item"
                               style="--level: {{ child.level + 1 }}"
                               onclick="selectFile(this, '{{ child.path }}', '{{ child.name }}')">
                                <i class="{{ child.icon }} mr-2 file-icon"></i>
                                <span class="file-name">{{ child.name }}</span>
                                <small class="text-muted float-right">{{ (child.size / 1024) | round(1) }}KB</small>
                            </a>
                        {% elif child.type == 'directory' %}
                            <!-- Nested directories would go here -->
                            <div class="list-group-item folder-item file-tree-item" style="--level: {{ child.level + 1 }}">
                                <i class="fas fa-folder text-warning mr-2"></i>
                                <span class="folder-name">{{ child.name }}</span>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            {% elif item.type == 'file' %}
                <a href="javascript:void(0)" 
                   class="list-group-item list-group-item-action file-item file-tree-item"
                   style="--level: {{ item.level }}"
                   onclick="selectFile(this, '{{ item.path }}', '{{ item.name }}')">
                    <i class="{{ item.icon }} mr-2 file-icon"></i>
                    <span class="file-name">{{ item.name }}</span>
                    <small class="text-muted float-right">{{ (item.size / 1024) | round(1) }}KB</small>
                </a>
            {% endif %}
        {% endfor %}
    </div>
</div>

<script>
function expandAllFolders() {
    const folders = document.querySelectorAll('[data-toggle="collapse"]');
    folders.forEach(folder => {
        const target = folder.getAttribute('data-target');
        const collapse = document.querySelector(target);
        if (collapse && !collapse.classList.contains('show')) {
            folder.click();
        }
    });
}

// Handle folder expand/collapse
document.addEventListener('DOMContentLoaded', function() {
    const folderItems = document.querySelectorAll('.folder-item[data-toggle="collapse"]');
    folderItems.forEach(item => {
        item.addEventListener('click', function() {
            const chevron = this.querySelector('.folder-chevron');
            const target = this.getAttribute('data-target');
            const collapse = document.querySelector(target);
            
            if (collapse) {
                // Toggle chevron rotation
                if (collapse.classList.contains('show')) {
                    chevron.classList.remove('rotated');
                } else {
                    chevron.classList.add('rotated');
                }
            }
        });
    });
});
</script>
