<div class="performance-tab">
    <!-- Performance Overview -->
    <div class="row mb-4">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-tachometer-alt text-success mr-2"></i>
                        Performance Testing
                    </h5>
                </div>
                <div class="card-body">
                    <!-- Performance Test Form -->
                    <form id="detailed-performance-form" class="mb-4">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="perf_user_count">Concurrent Users:</label>
                                    <input type="number" class="form-control" 
                                           id="perf_user_count" name="user_count" 
                                           value="10" min="1" max="100">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="perf_spawn_rate">Spawn Rate:</label>
                                    <input type="number" class="form-control" 
                                           id="perf_spawn_rate" name="spawn_rate" 
                                           value="1" min="1" max="10">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="perf_duration">Duration (seconds):</label>
                                    <input type="number" class="form-control" 
                                           id="perf_duration" name="duration" 
                                           value="30" min="10" max="300">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="perf_test_type">Test Type:</label>
                                    <select class="form-control" id="perf_test_type" name="test_type">
                                        <option value="load">Load Test</option>
                                        <option value="stress">Stress Test</option>
                                        <option value="spike">Spike Test</option>
                                        <option value="endurance">Endurance Test</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center">
                            <button type="submit" 
                                    class="btn btn-success"
                                    hx-post="/performance/{{ model }}/{{ app_num }}/run"
                                    hx-target="#detailed-performance-results"
                                    hx-include="#detailed-performance-form"
                                    hx-indicator="#detailed-performance-spinner">
                                <i class="fas fa-play mr-2"></i>
                                Run Performance Test
                            </button>
                            
                            <div class="btn-group" role="group">
                                <button type="button" 
                                        class="btn btn-outline-primary"
                                        hx-get="/api/performance/{{ model }}/{{ app_num }}/history"
                                        hx-target="#performance-history">
                                    <i class="fas fa-history mr-1"></i>
                                    View History
                                </button>
                                <button type="button" 
                                        class="btn btn-outline-secondary"
                                        hx-get="/api/performance/{{ model }}/{{ app_num }}/export"
                                        hx-target="#modal-container">
                                    <i class="fas fa-download mr-1"></i>
                                    Export Results
                                </button>
                            </div>
                        </div>
                    </form>
                    
                    <!-- Loading Indicator -->
                    <div id="detailed-performance-spinner" class="htmx-indicator text-center py-4">
                        <div class="spinner-border text-success" role="status">
                            <span class="sr-only">Running performance test...</span>
                        </div>
                        <p class="mt-2 text-muted">Running performance test, this may take a few minutes...</p>
                    </div>
                    
                    <!-- Performance Results -->
                    <div id="detailed-performance-results">
                        {% if existing_results %}
                            <div class="alert alert-success" role="alert">
                                <h6 class="alert-heading">
                                    <i class="fas fa-chart-line mr-2"></i>
                                    Latest Performance Results
                                </h6>
                                <hr>
                                <div class="row">
                                    <div class="col-md-3">
                                        <strong>Avg Response Time:</strong><br>
                                        <span class="h5 text-success">{{ existing_results.avg_response_time }}ms</span>
                                    </div>
                                    <div class="col-md-3">
                                        <strong>Max Response Time:</strong><br>
                                        <span class="h5 text-warning">{{ existing_results.max_response_time }}ms</span>
                                    </div>
                                    <div class="col-md-3">
                                        <strong>Requests/sec:</strong><br>
                                        <span class="h5 text-info">{{ existing_results.requests_per_second }}</span>
                                    </div>
                                    <div class="col-md-3">
                                        <strong>Failure Rate:</strong><br>
                                        <span class="h5 text-{{ 'danger' if existing_results.failure_rate > 5 else 'success' }}">
                                            {{ existing_results.failure_rate }}%
                                        </span>
                                    </div>
                                </div>
                                <hr>
                                <small class="text-muted">
                                    <i class="fas fa-clock mr-1"></i>
                                    Last run: {{ existing_results.timestamp|strftime('%Y-%m-%d %H:%M:%S') if existing_results.timestamp else 'Unknown' }}
                                </small>
                            </div>
                        {% else %}
                            <div class="alert alert-light border text-center" role="alert">
                                <i class="fas fa-tachometer-alt fa-3x text-muted mb-3"></i>
                                <h5>No Performance Results Yet</h5>
                                <p class="text-muted">Run a performance test to see detailed metrics and analytics here.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Performance Metrics Summary -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-bar text-primary mr-2"></i>
                        Performance Summary
                    </h5>
                </div>
                <div class="card-body">
                    {% if existing_results %}
                        <div class="performance-metric mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-muted">Overall Score</span>
                                <span class="badge badge-{{ 'success' if existing_results.score >= 80 else 'warning' if existing_results.score >= 60 else 'danger' }} badge-lg">
                                    {{ existing_results.score or 'N/A' }}/100
                                </span>
                            </div>
                            <div class="progress mt-2" style="height: 6px;">
                                <div class="progress-bar bg-{{ 'success' if existing_results.score >= 80 else 'warning' if existing_results.score >= 60 else 'danger' }}" 
                                     style="width: {{ existing_results.score or 0 }}%"></div>
                            </div>
                        </div>
                        
                        <div class="performance-metric mb-3">
                            <small class="text-muted">Response Time Distribution</small>
                            <div class="mt-2">
                                <div class="d-flex justify-content-between">
                                    <span>Min: {{ existing_results.min_response_time or 'N/A' }}ms</span>
                                    <span>Max: {{ existing_results.max_response_time or 'N/A' }}ms</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Avg: {{ existing_results.avg_response_time or 'N/A' }}ms</span>
                                    <span>95th: {{ existing_results.percentile_95 or 'N/A' }}ms</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="performance-metric mb-3">
                            <small class="text-muted">Throughput</small>
                            <div class="mt-1">
                                <strong>{{ existing_results.requests_per_second or 'N/A' }} req/sec</strong>
                            </div>
                        </div>
                        
                        <div class="performance-metric">
                            <small class="text-muted">Error Rate</small>
                            <div class="mt-1">
                                <strong class="text-{{ 'danger' if existing_results.failure_rate > 5 else 'success' }}">
                                    {{ existing_results.failure_rate or 0 }}%
                                </strong>
                            </div>
                        </div>
                    {% else %}
                        <div class="text-center text-muted">
                            <i class="fas fa-chart-line fa-2x mb-3"></i>
                            <p>Run a performance test to see metrics</p>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Performance History -->
            <div class="card mt-3">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-history text-info mr-2"></i>
                        Recent Tests
                    </h6>
                </div>
                <div class="card-body p-0" id="performance-history">
                    <div class="list-group list-group-flush">
                        {% if has_results %}
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <small class="text-muted">Latest Test</small><br>
                                    <strong>{{ existing_results.test_type|title if existing_results.test_type else 'Load Test' }}</strong>
                                </div>
                                <span class="badge badge-primary">
                                    {{ existing_results.score or 'N/A' }}
                                </span>
                            </div>
                        {% else %}
                            <div class="list-group-item text-center text-muted">
                                <i class="fas fa-history mr-2"></i>
                                No test history yet
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Detailed Performance Charts -->
    {% if existing_results %}
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-area text-primary mr-2"></i>
                        Performance Charts
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Response Time Trend</h6>
                            <div class="chart-placeholder bg-light p-4 text-center rounded">
                                <i class="fas fa-chart-line fa-2x text-muted mb-2"></i>
                                <p class="text-muted mb-0">Response time chart would be displayed here</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>Throughput Over Time</h6>
                            <div class="chart-placeholder bg-light p-4 text-center rounded">
                                <i class="fas fa-chart-bar fa-2x text-muted mb-2"></i>
                                <p class="text-muted mb-0">Throughput chart would be displayed here</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
