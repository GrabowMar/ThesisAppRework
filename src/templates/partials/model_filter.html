<!-- HTMX Partial: Model Filter Options -->
<div class="filter-options" id="model-filter-options">
    <div class="filter-header">
        <label class="filter-label">
            <input type="checkbox" 
                   class="select-all-models" 
                   onchange="ThesisApp.ui.toggleAllFilters(this, '.model-option input')"
                   {% if selected_models|length == available_models|length %}checked{% endif %}>
            All Models
        </label>
        <span class="filter-count">{{ selected_models|length }}/{{ available_models|length }}</span>
    </div>
    
    <div class="filter-search">
        <input type="text" 
               placeholder="Search models..." 
               class="filter-search-input"
               oninput="ThesisApp.ui.filterOptions(this, '.model-option')"
               autocomplete="off">
    </div>
    
    <div class="filter-options-list" role="listbox" aria-label="Model selection">
        {% for provider, models in available_models|groupby('provider') %}
        <div class="filter-group">
            <div class="filter-group-header">
                <label class="filter-group-label">
                    <input type="checkbox" 
                           class="select-group-models" 
                           data-group="{{ provider }}"
                           onchange="ThesisApp.ui.toggleGroupFilters(this, '.model-option[data-provider=&quot;{{ provider }}&quot;] input')"
                           {% if models|selectattr('slug', 'in', selected_models)|list|length == models|length %}checked{% endif %}>
                    {{ provider.replace('_', ' ').title() }}
                </label>
                <span class="group-count">{{ models|selectattr('slug', 'in', selected_models)|list|length }}/{{ models|length }}</span>
            </div>
            
            <div class="filter-group-options">
                {% for model in models %}
                <label class="model-option" 
                       data-provider="{{ provider }}"
                       data-searchable="{{ model.name.lower() }} {{ model.slug.lower() }}">
                    <input type="checkbox" 
                           name="models" 
                           value="{{ model.slug }}"
                           {% if model.slug in selected_models %}checked{% endif %}
                           hx-post="{{ url_for('main.update_filters') }}"
                           hx-trigger="change"
                           hx-target="#dashboard-content"
                           hx-include="[name='models']:checked, [name='status']:checked, [name='app_types']:checked">
                    
                    <div class="model-info">
                        <span class="model-name">{{ model.name }}</span>
                        <div class="model-meta">
                            <span class="model-apps">{{ model.app_count }} apps</span>
                            {% if model.context_window %}
                            <span class="model-context">{{ model.context_window|filesizeformat(binary=False) }} ctx</span>
                            {% endif %}
                            {% if model.pricing %}
                            <span class="model-price">${{ "%.4f"|format(model.pricing.input_cost_per_token * 1000) }}/1k</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    {% if model.capabilities %}
                    <div class="model-capabilities">
                        {% if model.capabilities.function_calling %}
                        <span class="capability-badge" title="Function Calling">üîß</span>
                        {% endif %}
                        {% if model.capabilities.vision %}
                        <span class="capability-badge" title="Vision">üëÅÔ∏è</span>
                        {% endif %}
                        {% if model.capabilities.json_mode %}
                        <span class="capability-badge" title="JSON Mode">üìã</span>
                        {% endif %}
                    </div>
                    {% endif %}
                </label>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<style>
.filter-options {
    background: var(--background-color);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-md);
    max-height: 400px;
    min-width: 300px;
    z-index: 1000;
}

.filter-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--spacing);
    border-bottom: 1px solid var(--border-color);
    font-weight: 500;
}

.filter-label {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    cursor: pointer;
    margin: 0;
}

.filter-count {
    font-size: 0.8rem;
    color: var(--text-muted);
    background: var(--surface-color);
    padding: 0.125rem 0.375rem;
    border-radius: 0.75rem;
}

.filter-search {
    padding: var(--spacing-sm);
    border-bottom: 1px solid var(--border-color);
}

.filter-search-input {
    width: 100%;
    padding: var(--spacing-sm);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    font-size: 0.875rem;
    background: var(--background-color);
}

.filter-search-input:focus {
    outline: none;
    border-color: var(--accent-color);
    box-shadow: 0 0 0 2px rgba(0, 122, 204, 0.1);
}

.filter-options-list {
    max-height: 280px;
    overflow-y: auto;
    padding: var(--spacing-sm);
}

.filter-group {
    margin-bottom: var(--spacing);
}

.filter-group:last-child {
    margin-bottom: 0;
}

.filter-group-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--spacing-sm);
    background: var(--surface-color);
    border-radius: var(--border-radius);
    margin-bottom: var(--spacing-sm);
    font-size: 0.875rem;
    font-weight: 500;
}

.filter-group-label {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    cursor: pointer;
    margin: 0;
}

.group-count {
    font-size: 0.75rem;
    color: var(--text-muted);
}

.filter-group-options {
    margin-left: var(--spacing);
}

.model-option {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm);
    cursor: pointer;
    border-radius: var(--border-radius);
    transition: background var(--transition-fast);
    margin: 0 0 0.125rem 0;
}

.model-option:hover {
    background: var(--surface-color);
}

.model-option[style*="display: none"] {
    display: none !important;
}

.model-info {
    flex: 1;
    min-width: 0;
}

.model-name {
    font-weight: 500;
    font-size: 0.875rem;
    display: block;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.model-meta {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin-top: 0.125rem;
    font-size: 0.7rem;
    color: var(--text-muted);
}

.model-apps {
    color: var(--accent-color);
    font-weight: 500;
}

.model-context,
.model-price {
    background: var(--surface-color);
    padding: 0.0625rem 0.25rem;
    border-radius: 0.25rem;
}

.model-capabilities {
    display: flex;
    gap: 0.125rem;
    flex-shrink: 0;
}

.capability-badge {
    font-size: 0.7rem;
    opacity: 0.7;
    cursor: help;
}

/* Checkbox styling */
input[type="checkbox"] {
    width: 16px;
    height: 16px;
    border: 1px solid var(--border-color);
    border-radius: 0.125rem;
    background: var(--background-color);
}

input[type="checkbox"]:checked {
    background: var(--accent-color);
    border-color: var(--accent-color);
}

input[type="checkbox"]:focus {
    outline: 2px solid rgba(0, 122, 204, 0.2);
    outline-offset: 1px;
}

/* Scrollbar styling */
.filter-options-list::-webkit-scrollbar {
    width: 6px;
}

.filter-options-list::-webkit-scrollbar-track {
    background: var(--surface-color);
}

.filter-options-list::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 3px;
}

.filter-options-list::-webkit-scrollbar-thumb:hover {
    background: var(--text-muted);
}

/* Mobile responsive */
@media (max-width: 480px) {
    .filter-options {
        min-width: 280px;
        max-height: 350px;
    }
    
    .model-meta {
        flex-wrap: wrap;
    }
    
    .model-capabilities {
        margin-top: 0.125rem;
    }
}
</style>

<script>
// Filter functionality for model options
document.addEventListener('htmx:afterSwap', function(event) {
    if (event.target.id === 'model-filter-options') {
        // Initialize filter counts
        ThesisApp.ui.updateFilterCounts();
    }
});
</script>
