<!-- Application Grid/List -->
<div class="app-grid">
    {% if apps %}
        {% for app in apps %}
        <div class="app-card" 
             data-model="{{ app.model }}" 
             data-app="{{ app.app_num }}"
             hx-get="{{ url_for('api.get_app_status', model=app.model, app_num=app.app_num) }}"
             hx-trigger="load, every 30s"
             hx-target="find .app-status"
             hx-swap="outerHTML">
            
            <!-- App Header -->
            <div class="app-header">
                <div class="app-title">
                    <h3>
                        <a href="{{ url_for('main.app_details', model=app.model, app_num=app.app_num) }}"
                           class="app-link">
                            {{ app.app_name }} <span class="app-number">#{{ app.app_num }}</span>
                        </a>
                    </h3>
                    <p class="app-model">{{ app.model_display_name }}</p>
                </div>
                
                <div class="app-actions">
                    <div class="dropdown">
                        <button class="btn btn-sm btn-ghost dropdown-toggle" data-dropdown="app-{{ app.model }}-{{ app.app_num }}">
                            ‚ãÆ
                        </button>
                        <div class="dropdown-menu" id="app-{{ app.model }}-{{ app.app_num }}">
                            <a href="{{ url_for('main.app_details', model=app.model, app_num=app.app_num) }}" class="dropdown-item">
                                üìù View Details
                            </a>
                            <button class="dropdown-item"
                                    hx-post="{{ url_for('docker.docker_action', action='start', model=app.model, app_num=app.app_num) }}"
                                    hx-target="#flash-messages">
                                ‚ñ∂Ô∏è Start Containers
                            </button>
                            <button class="dropdown-item"
                                    hx-post="{{ url_for('docker.docker_action', action='stop', model=app.model, app_num=app.app_num) }}"
                                    hx-target="#flash-messages">
                                ‚èπÔ∏è Stop Containers
                            </button>
                            <div class="dropdown-divider"></div>
                            <button class="dropdown-item"
                                    hx-post="{{ url_for('analysis.run_analysis', analysis_type='security', model=app.model, app_num=app.app_num) }}"
                                    hx-target="#flash-messages">
                                üîç Run Security Analysis
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- App Status -->
            <div class="app-status status-{{ app.status|default('unknown') }}">
                <div class="status-indicator">
                    <span class="status-dot"></span>
                    <span class="status-text">{{ app.status_display|default('Unknown') }}</span>
                </div>
                
                {% if app.ports %}
                <div class="app-ports">
                    <span class="port-label">Frontend:</span>
                    <a href="http://localhost:{{ app.ports.frontend }}" 
                       target="_blank" 
                       class="port-link">{{ app.ports.frontend }}</a>
                    
                    <span class="port-label">Backend:</span>
                    <a href="http://localhost:{{ app.ports.backend }}" 
                       target="_blank" 
                       class="port-link">{{ app.ports.backend }}</a>
                </div>
                {% endif %}
            </div>
            
            <!-- App Info -->
            <div class="app-info">
                <div class="info-row">
                    <span class="info-label">Type:</span>
                    <span class="info-value">{{ app.app_type|default('Unknown') }}</span>
                </div>
                
                <div class="info-row">
                    <span class="info-label">Last Analysis:</span>
                    <span class="info-value">
                        {% if app.last_analysis %}
                            {{ app.last_analysis|format_datetime }}
                        {% else %}
                            Never
                        {% endif %}
                    </span>
                </div>
                
                {% if app.analysis_results %}
                <div class="analysis-badges">
                    {% for result_type, result in app.analysis_results.items() %}
                        <span class="badge badge-{{ 'success' if result.status == 'completed' else 'warning' if result.status == 'running' else 'error' }}">
                            {{ result_type|title }}
                        </span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            
            <!-- Quick Actions -->
            <div class="app-footer">
                <div class="app-actions-footer">
                    <button class="btn btn-sm btn-primary"
                            hx-get="{{ url_for('main.app_details', model=app.model, app_num=app.app_num) }}">
                        View Details
                    </button>
                    
                    {% if app.status == 'running' %}
                    <button class="btn btn-sm btn-success"
                            onclick="window.open('http://localhost:{{ app.ports.frontend }}', '_blank')">
                        üåê Open App
                    </button>
                    {% else %}
                    <button class="btn btn-sm btn-secondary"
                            hx-post="{{ url_for('docker.docker_action', action='start', model=app.model, app_num=app.app_num) }}"
                            hx-target="closest .app-card"
                            hx-swap="outerHTML">
                        ‚ñ∂Ô∏è Start
                    </button>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <!-- Empty State -->
        <div class="empty-state">
            <div class="empty-icon">üì±</div>
            <h3>No Applications Found</h3>
            <p>No applications match your current search criteria.</p>
            {% if request.args.get('search') or request.args.get('model') or request.args.get('status') %}
            <button class="btn btn-secondary"
                    hx-get="{{ url_for('api.search_apps') }}"
                    hx-target="#app-list"
                    hx-vals='{"search": "", "model": "", "status": ""}'>
                Clear Filters
            </button>
            {% endif %}
        </div>
    {% endif %}
</div>

<!-- Pagination -->
{% if pagination %}
<div class="pagination-container">
    <nav class="pagination" role="navigation" aria-label="Pagination">
        {% if pagination.has_prev %}
        <button class="pagination-btn pagination-prev"
                hx-get="{{ url_for('api.search_apps', page=pagination.prev_num, search=request.args.get('search', ''), model=request.args.get('model', ''), status=request.args.get('status', '')) }}"
                hx-target="#app-list">
            ‚Üê Previous
        </button>
        {% endif %}
        
        <div class="pagination-info">
            Page {{ pagination.page }} of {{ pagination.pages }}
            ({{ pagination.total }} total)
        </div>
        
        {% if pagination.has_next %}
        <button class="pagination-btn pagination-next"
                hx-get="{{ url_for('api.search_apps', page=pagination.next_num, search=request.args.get('search', ''), model=request.args.get('model', ''), status=request.args.get('status', '')) }}"
                hx-target="#app-list">
            Next ‚Üí
        </button>
        {% endif %}
    </nav>
</div>
{% endif %}
