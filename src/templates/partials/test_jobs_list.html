{% if jobs %}
<div class="table-responsive">
    <table class="table table-hover">
        <thead class="table-light">
            <tr>
                <th>ID</th>
                <th>Type</th>
                <th>Status</th>
                <th>Model/App</th>
                <th>Created</th>
                <th>Duration</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for job in jobs %}
            <tr>
                <td>
                    <code class="small">{{ job.id[:8] }}</code>
                </td>
                <td>
                    <span class="badge 
                        {% if job.get_primary_job_type() == 'security' %}bg-warning
                        {% elif job.get_primary_job_type() == 'performance' %}bg-info
                        {% elif job.get_primary_job_type() == 'zap' %}bg-danger
                        {% else %}bg-secondary{% endif %}">
                        {{ job.get_primary_job_type().title() }}
                    </span>
                </td>
                <td>
                    <span class="badge 
                        {% if job.status.name == 'COMPLETED' %}bg-success
                        {% elif job.status.name == 'RUNNING' %}bg-primary
                        {% elif job.status.name == 'FAILED' %}bg-danger
                        {% elif job.status.name == 'PENDING' %}bg-warning
                        {% else %}bg-secondary{% endif %}">
                        <i class="fas 
                            {% if job.status.name == 'COMPLETED' %}fa-check
                            {% elif job.status.name == 'RUNNING' %}fa-play
                            {% elif job.status.name == 'FAILED' %}fa-times
                            {% elif job.status.name == 'PENDING' %}fa-clock
                            {% else %}fa-question{% endif %} me-1"></i>
                        {{ job.status.name.title() }}
                    </span>
                </td>
                <td>
                    {% if job.model_slug and job.app_number %}
                        <small>{{ job.model_slug }}/app{{ job.app_number }}</small>
                    {% else %}
                        <small class="text-muted">Batch job</small>
                    {% endif %}
                </td>
                <td>
                    <small class="text-muted">{{ job.created_at.strftime('%m/%d %H:%M') }}</small>
                </td>
                <td>
                    {% if job.status.name == 'COMPLETED' and job.completed_at %}
                        {% set duration = (job.completed_at - job.created_at).total_seconds() %}
                        <small class="text-muted">{{ "%.1f"|format(duration) }}s</small>
                    {% elif job.status.name == 'RUNNING' %}
                        <small class="text-primary">
                            <i class="fas fa-spinner fa-spin me-1"></i>Running
                        </small>
                    {% else %}
                        <small class="text-muted">-</small>
                    {% endif %}
                </td>
                <td>
                    <div class="btn-group btn-group-sm" role="group">
                        <!-- View Details Button -->
                        <button class="btn btn-outline-primary btn-sm" 
                                hx-get="/testing/api/job/{{ job.id }}/progress"
                                hx-target="#test-details-modal"
                                hx-swap="innerHTML"
                                data-bs-toggle="modal" 
                                data-bs-target="#testDetailsModal"
                                title="View Progress">
                            <i class="fas fa-tasks"></i>
                        </button>
                        
                        <!-- Start/Stop Controls -->
                        {% if job.status.name == 'PENDING' %}
                        <button class="btn btn-outline-success btn-sm"
                                hx-post="/testing/api/job/{{ job.id }}/start"
                                hx-target="#job-actions-feedback"
                                hx-swap="innerHTML"
                                title="Start Job">
                            <i class="fas fa-play"></i>
                        </button>
                        {% elif job.status.name == 'RUNNING' %}
                        <button class="btn btn-outline-danger btn-sm"
                                hx-post="/testing/api/job/{{ job.id }}/stop"
                                hx-target="#job-actions-feedback"
                                hx-swap="innerHTML"
                                title="Stop Job">
                            <i class="fas fa-stop"></i>
                        </button>
                        {% endif %}
                        
                        <!-- Results Button -->
                        {% if job.status.name in ['COMPLETED', 'FAILED'] %}
                        <button class="btn btn-outline-info btn-sm"
                                hx-get="/testing/api/job/{{ job.id }}/results"
                                hx-target="#test-results-modal"
                                hx-swap="innerHTML"
                                data-bs-toggle="modal" 
                                data-bs-target="#testResultsModal"
                                title="View Results">
                            <i class="fas fa-chart-bar"></i>
                        </button>
                        {% endif %}
                        
                        <!-- Logs Button -->
                        <button class="btn btn-outline-secondary btn-sm"
                                hx-get="/testing/api/job/{{ job.id }}/logs"
                                hx-target="#test-logs-modal"
                                hx-swap="innerHTML"
                                data-bs-toggle="modal" 
                                data-bs-target="#testLogsModal"
                                title="View Logs">
                            <i class="fas fa-terminal"></i>
                        </button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="text-center py-4">
    <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
    <p class="text-muted">No test jobs found</p>
    <button class="btn btn-primary" 
            hx-get="/testing/api/new-test-form"
            hx-target="#modal-container"
            hx-swap="innerHTML">
        <i class="fas fa-plus me-2"></i>Start Your First Test
    </button>
</div>
{% endif %}
