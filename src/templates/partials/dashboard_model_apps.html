<!-- Dashboard Model Apps - Compact Table View -->
<div class="table-responsive">
    <table class="table table-sm table-hover mb-0">
        <thead class="thead-light">
            <tr>
                <th width="8%">App</th>
                <th width="20%">Name</th>
                <th width="10%">Status</th>
                <th width="12%">Containers</th>
                <th width="15%">Ports</th>
                <th width="15%">Analysis</th>
                <th width="20%">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for app in apps %}
            <tr id="app-{{ model_slug }}-{{ app.app_number }}" class="app-row">
                <!-- App Number -->
                <td class="align-middle">
                    <span class="badge badge-outline-primary px-2">{{ app.app_number }}</span>
                </td>
                
                <!-- App Name -->
                <td class="align-middle">
                    <div class="app-info">
                        <div class="font-weight-medium">{{ app.app_name }}</div>
                        <small class="text-muted d-block">{{ app.description[:40] }}{% if app.description|length > 40 %}...{% endif %}</small>
                    </div>
                </td>
                
                <!-- Status -->
                <td class="align-middle">
                    <span class="badge badge-{{ 'success' if app.status == 'running' else 'warning' if app.status == 'stopped' else 'danger' }} badge-pill">
                        <i class="fas fa-circle mr-1 icon-sm"></i>
                        {{ app.status|title }}
                    </span>
                </td>
                
                <!-- Container Status -->
                <td class="align-middle">
                    <div class="d-flex justify-content-start">
                        <span class="mx-1 {{ 'text-success' if app.containers.frontend_status == 'running' else 'text-muted' }}"
                              title="Frontend: {{ app.containers.frontend_status|title }}">
                            <i class="fas fa-globe-americas icon-md"></i>
                        </span>
                        <span class="mx-1 {{ 'text-success' if app.containers.backend_status == 'running' else 'text-muted' }}"
                              title="Backend: {{ app.containers.backend_status|title }}">
                            <i class="fas fa-cogs icon-md"></i>
                        </span>
                        <span class="mx-1 {{ 'text-success' if app.containers.database_status == 'running' else 'text-muted' }}"
                              title="Database: {{ app.containers.database_status|title }}">
                            <i class="fas fa-database icon-md"></i>
                        </span>
                    </div>
                </td>
                
                <!-- Ports -->
                <td class="align-middle">
                    <div class="port-info">
                        <small class="d-block">
                            <i class="fas fa-desktop mr-1"></i>{{ app.frontend_port }}
                        </small>
                        <small class="d-block">
                            <i class="fas fa-server mr-1"></i>{{ app.backend_port }}
                        </small>
                    </div>
                </td>
                
                <!-- Analysis Summary -->
                <td class="align-middle">
                    {% if app.analysis_summary %}
                    <div class="d-flex justify-content-between analysis-compact">
                        <span class="text-danger" title="High Issues">
                            <i class="fas fa-exclamation-triangle"></i> {{ app.analysis_summary.high_issues }}
                        </span>
                        <span class="text-warning" title="Medium Issues">
                            <i class="fas fa-exclamation-circle"></i> {{ app.analysis_summary.medium_issues }}
                        </span>
                        <span class="text-success" title="Low Issues">
                            <i class="fas fa-info-circle"></i> {{ app.analysis_summary.low_issues }}
                        </span>
                    </div>
                    {% if app.performance_summary %}
                    <div class="mt-1">
                        <small class="text-muted">
                            {{ '%.0f'|format(app.performance_summary.avg_response_time) }}ms | 
                            {{ '%.1f'|format(app.performance_summary.success_rate) }}%
                        </small>
                    </div>
                    {% endif %}
                    {% else %}
                    <small class="text-muted">No analysis</small>
                    {% endif %}
                </td>
                
                <!-- Actions -->
                <td class="align-middle">
                    <div class="btn-group btn-group-sm" role="group">
                        <!-- Primary Actions -->
                        {% if app.status.lower() == 'stopped' %}
                        <button class="btn btn-outline-success btn-xs" 
                                hx-post="/api/containers/{{ model_slug }}/{{ app.app_number }}/start"
                                hx-target="#app-{{ model_slug }}-{{ app.app_number }}"
                                hx-swap="outerHTML"
                                title="Start containers">
                            <i class="fas fa-play"></i>
                        </button>
                        {% elif app.status.lower() == 'running' %}
                        <button class="btn btn-outline-warning btn-xs" 
                                hx-post="/api/containers/{{ model_slug }}/{{ app.app_number }}/restart"
                                hx-target="#app-{{ model_slug }}-{{ app.app_number }}"
                                hx-swap="outerHTML"
                                title="Restart containers">
                            <i class="fas fa-redo"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-xs" 
                                hx-post="/api/containers/{{ model_slug }}/{{ app.app_number }}/stop"
                                hx-target="#app-{{ model_slug }}-{{ app.app_number }}"
                                hx-swap="outerHTML"
                                title="Stop containers">
                            <i class="fas fa-stop"></i>
                        </button>
                        {% elif app.status.lower() == 'error' %}
                        <button class="btn btn-outline-warning btn-xs" 
                                hx-post="/api/containers/{{ model_slug }}/{{ app.app_number }}/restart"
                                hx-target="#app-{{ model_slug }}-{{ app.app_number }}"
                                hx-swap="outerHTML"
                                title="Restart containers">
                            <i class="fas fa-redo"></i>
                        </button>
                        {% endif %}
                        
                        <!-- Open App -->
                        {% if app.status.lower() == 'running' %}
                        <button class="btn btn-outline-primary btn-xs" 
                                onclick="window.open('http://localhost:{{ app.frontend_port }}', '_blank')"
                                title="Open app">
                            <i class="fas fa-external-link-alt"></i>
                        </button>
                        {% endif %}
                        
                        <!-- Dropdown for Additional Actions -->
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-secondary btn-xs dropdown-toggle dropdown-toggle-split" 
                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="sr-only">Toggle Dropdown</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-right">
                                <a class="dropdown-item" href="#" 
                                   onclick="showAppLogs('{{ model_slug }}', {{ app.app_number }})">
                                    <i class="fas fa-file-alt mr-2"></i>View Logs
                                </a>
                                <a class="dropdown-item" 
                                   href="/app/{{ model_slug }}/{{ app.app_number }}?tab=analysis">
                                    <i class="fas fa-shield-alt mr-2"></i>Security Analysis
                                </a>
                                <a class="dropdown-item" 
                                   href="/app/{{ model_slug }}/{{ app.app_number }}?tab=performance">
                                    <i class="fas fa-bolt mr-2"></i>Performance Test
                                </a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" 
                                   href="/app/{{ model_slug }}/{{ app.app_number }}">
                                    <i class="fas fa-info-circle mr-2"></i>View Details
                                </a>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- No Apps State -->
{% if not apps %}
<div class="text-center py-4">
    <i class="fas fa-box-open fa-2x text-muted mb-2"></i>
    <p class="text-muted mb-0">No applications found for this model</p>
</div>
{% endif %}

<script>
// App-specific functions using HTMX and Bootstrap
function showAppLogs(modelSlug, appNum) {
    // Load logs via HTMX
    htmx.ajax('GET', `/api/containers/${modelSlug}/${appNum}/logs`, {
        target: '#container-logs-content',
        swap: 'innerHTML'
    });
    
    // Show modal using Bootstrap
    $('#containerLogsModal').modal('show');
}

// Initialize tooltips for app table
$(document).ready(function() {
    $('[title]').tooltip();
});
</script>


