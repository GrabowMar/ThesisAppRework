<!-- Applications List -->
<div class="row" id="apps-list">
    {% for app in apps %}
    <div class="col-lg-6 col-xl-4 mb-4">
        <div class="card card-hover h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="mb-0">
                    <i class="bi bi-box"></i> 
                    {{ app.model }}/app{{ app.app_num }}
                </h6>
                <div class="container-status"
                     hx-get="{{ url_for('api.get_app_status', model=app.model, app_num=app.app_num) }}"
                     hx-trigger="load, every 10s"
                     hx-swap="outerHTML">
                    <!-- Status will be loaded here -->
                    <span class="badge bg-secondary">
                        <i class="bi bi-hourglass-split"></i> Loading...
                    </span>
                </div>
            </div>
            
            <div class="card-body">
                <div class="row">
                    <div class="col-6">
                        <small class="text-muted">Frontend Port</small>
                        <div class="fw-bold">{{ app.frontend_port }}</div>
                    </div>
                    <div class="col-6">
                        <small class="text-muted">Backend Port</small>
                        <div class="fw-bold">{{ app.backend_port }}</div>
                    </div>
                </div>
                
                {% if app.get('last_analysis') %}
                <div class="mt-2">
                    <small class="text-muted">Last Analysis</small>
                    <div class="small">{{ app.last_analysis|format_datetime }}</div>
                </div>
                {% endif %}
            </div>
            
            <div class="card-footer">
                <div class="row g-1">
                    <div class="col-4">
                        <a href="{{ url_for('main.app_details', model=app.model, app_num=app.app_num) }}" 
                           class="btn btn-primary btn-sm w-100">
                            <i class="bi bi-eye"></i> View
                        </a>
                    </div>
                    <div class="col-4">
                        <button class="btn btn-success btn-sm w-100"
                                hx-post="{{ url_for('docker.docker_action', action='start', model=app.model, app_num=app.app_num) }}"
                                hx-target="closest .card"
                                hx-swap="outerHTML"
                                data-bs-toggle="tooltip" title="Start containers">
                            <i class="bi bi-play"></i>
                        </button>
                    </div>
                    <div class="col-4">
                        <button class="btn btn-danger btn-sm w-100"
                                hx-post="{{ url_for('docker.docker_action', action='stop', model=app.model, app_num=app.app_num) }}"
                                hx-target="closest .card"
                                hx-swap="outerHTML"
                                data-bs-toggle="tooltip" title="Stop containers">
                            <i class="bi bi-stop"></i>
                        </button>
                    </div>
                </div>
                
                <div class="row g-1 mt-1">
                    <div class="col-6">
                        {% if get_app_url(app.model, app.app_num) %}
                        <a href="{{ get_app_url(app.model, app.app_num) }}" 
                           target="_blank" 
                           class="btn btn-outline-primary btn-sm w-100">
                            <i class="bi bi-box-arrow-up-right"></i> Open App
                        </a>
                        {% else %}
                        <button class="btn btn-outline-secondary btn-sm w-100" disabled>
                            <i class="bi bi-box-arrow-up-right"></i> Open App
                        </button>
                        {% endif %}
                    </div>
                    <div class="col-6">
                        <div class="dropdown">
                            <button class="btn btn-outline-secondary btn-sm dropdown-toggle w-100" 
                                    type="button" data-bs-toggle="dropdown">
                                <i class="bi bi-tools"></i> Tools
                            </button>
                            <ul class="dropdown-menu">
                                <li>
                                    <a class="dropdown-item" 
                                       href="{{ url_for('analysis.analysis_details', analysis_type='backend_security', model=app.model, app_num=app.app_num) }}">
                                        <i class="bi bi-shield-check"></i> Security Analysis
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" 
                                       href="{{ url_for('performance.performance_test_page', model=app.model, app_num=app.app_num) }}">
                                        <i class="bi bi-speedometer2"></i> Performance Test
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" 
                                       href="{{ url_for('zap.zap_scan_page', model=app.model, app_num=app.app_num) }}">
                                        <i class="bi bi-bug"></i> ZAP Scan
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" 
                                       href="{{ url_for('docker.view_logs', model=app.model, app_num=app.app_num) }}">
                                        <i class="bi bi-file-text"></i> View Logs
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% if not apps %}
<div class="col-12">
    <div class="text-center py-5">
        <i class="bi bi-inbox display-1 text-muted"></i>
        <h4 class="mt-3 text-muted">No applications found</h4>
        <p class="text-muted">Try adjusting your search filters or check if applications are properly configured.</p>
    </div>
</div>
{% endif %}

{% if has_more %}
<div class="col-12 text-center">
    <button class="btn btn-outline-primary"
            hx-get="{{ url_for('api.search_apps') }}?page={{ filters.page + 1 }}"
            hx-target="#apps-list"
            hx-swap="beforeend"
            hx-include="[name='search'], [name='model'], [name='status']">
        <i class="bi bi-arrow-down"></i> Load More
    </button>
</div>
{% endif %}
