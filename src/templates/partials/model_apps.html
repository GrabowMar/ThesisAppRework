<!-- Applications Grid for Specific Model -->
<div class="apps-grid">
    {% for app in apps %}
    <div class="app-card" 
         data-app-id="{{ app.id }}"
         data-model-slug="{{ model_slug }}"
         data-app-number="{{ app.app_number }}"
         _="on mouseenter add .hover to me
            on mouseleave remove .hover from me">
        
        <!-- App Header -->
        <div class="app-header">
            <div class="app-title">
                <h4>App {{ app.app_number }}</h4>
                <span class="app-type">{{ app.app_type or 'Web Application' }}</span>
            </div>
            
            <div class="app-status">
                {% if app.container_status == 'running' %}
                    <span class="status-badge running">Running</span>
                {% elif app.container_status == 'stopped' %}
                    <span class="status-badge stopped">Stopped</span>
                {% elif app.container_status == 'error' %}
                    <span class="status-badge error">Error</span>
                {% else %}
                    <span class="status-badge unknown">Unknown</span>
                {% endif %}
            </div>
        </div>
        
        <!-- App Details -->
        <div class="app-details">
            <div class="app-ports">
                <div class="port-info">
                    <span class="port-label">Frontend:</span>
                    <span class="port-value">{{ app.frontend_port or 'N/A' }}</span>
                </div>
                <div class="port-info">
                    <span class="port-label">Backend:</span>
                    <span class="port-value">{{ app.backend_port or 'N/A' }}</span>
                </div>
            </div>
            
            {% if app.last_analysis %}
            <div class="app-analysis">
                <span class="analysis-date">
                    Last analyzed: {{ app.last_analysis.strftime('%m/%d %H:%M') }}
                </span>
                {% if app.analysis_results %}
                <div class="analysis-summary">
                    <span class="security-score">
                        Security: {{ app.analysis_results.get('security_score', 'N/A') }}
                    </span>
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>
        
        <!-- App Actions -->
        <div class="app-actions">
            <!-- Container Controls -->
            <div class="container-controls">
                {% if app.container_status != 'running' %}
                <button class="btn-sm btn-success"
                        hx-post="/api/docker/{{ model_slug }}/app{{ app.app_number }}/start"
                        hx-target="closest .app-card"
                        hx-swap="outerHTML"
                        hx-confirm="Start this application container?"
                        _="on click add .loading to me">
                    ‚ñ∂Ô∏è Start
                </button>
                {% else %}
                <button class="btn-sm btn-danger"
                        hx-post="/api/docker/{{ model_slug }}/app{{ app.app_number }}/stop"
                        hx-target="closest .app-card"
                        hx-swap="outerHTML"
                        hx-confirm="Stop this application container?"
                        _="on click add .loading to me">
                    ‚èπÔ∏è Stop
                </button>
                {% endif %}
                
                <button class="btn-sm btn-secondary"
                        hx-post="/api/docker/{{ model_slug }}/app{{ app.app_number }}/restart"
                        hx-target="closest .app-card"
                        hx-swap="outerHTML"
                        hx-confirm="Restart this application container?"
                        _="on click add .loading to me">
                    üîÑ Restart
                </button>
            </div>
            
            <!-- Testing Actions -->
            <div class="test-controls">
                <button class="btn-sm btn-primary"
                        hx-get="/api/analysis/{{ model_slug }}/app{{ app.app_number }}/security"
                        hx-target="#app-test-modal .modal-content"
                        _="on click show #app-test-modal">
                    üîí Security Test
                </button>
                
                <button class="btn-sm btn-info"
                        hx-get="/api/analysis/{{ model_slug }}/app{{ app.app_number }}/performance"
                        hx-target="#app-test-modal .modal-content"
                        _="on click show #app-test-modal">
                    ‚ö° Performance Test
                </button>
                
                <button class="btn-sm btn-warning"
                        hx-get="/api/analysis/{{ model_slug }}/app{{ app.app_number }}/zap"
                        hx-target="#app-test-modal .modal-content"
                        _="on click show #app-test-modal">
                    üîç ZAP Scan
                </button>
            </div>
            
            <!-- Access Links -->
            <div class="access-links">
                {% if app.container_status == 'running' %}
                    {% if app.frontend_port %}
                    <a href="http://localhost:{{ app.frontend_port }}" 
                       target="_blank" 
                       class="btn-link">
                        üåê Frontend
                    </a>
                    {% endif %}
                    
                    {% if app.backend_port %}
                    <a href="http://localhost:{{ app.backend_port }}" 
                       target="_blank" 
                       class="btn-link">
                        üîß Backend
                    </a>
                    {% endif %}
                {% else %}
                    <span class="access-disabled">Start app to access</span>
                {% endif %}
            </div>
        </div>
        
        <!-- App Progress Indicators -->
        <div class="app-progress">
            {% if app.build_status %}
            <div class="progress-item">
                <span class="progress-label">Build:</span>
                <span class="progress-value {{ app.build_status }}">
                    {{ app.build_status|title }}
                </span>
            </div>
            {% endif %}
            
            {% if app.deploy_status %}
            <div class="progress-item">
                <span class="progress-label">Deploy:</span>
                <span class="progress-value {{ app.deploy_status }}">
                    {{ app.deploy_status|title }}
                </span>
            </div>
            {% endif %}
        </div>
        
        <!-- Quick Info Tooltip -->
        <div class="app-tooltip"
             _="on mouseenter from closest .app-card
                show me with *opacity from 0 to 1 over 200ms
                on mouseleave from closest .app-card
                hide me with *opacity from 1 to 0 over 200ms"
             style="display: none;">
            <div class="tooltip-content">
                <h5>{{ model_slug|replace('_', ' ')|title }} - App {{ app.app_number }}</h5>
                <p><strong>Type:</strong> {{ app.app_type or 'Web Application' }}</p>
                <p><strong>Created:</strong> {{ app.created_at.strftime('%m/%d/%Y') if app.created_at else 'Unknown' }}</p>
                <p><strong>Status:</strong> {{ app.container_status|title }}</p>
                {% if app.frontend_port and app.backend_port %}
                <p><strong>Ports:</strong> {{ app.frontend_port }} (frontend), {{ app.backend_port }} (backend)</p>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Apps Summary for This Model -->
<div class="apps-summary">
    <div class="summary-info">
        <span class="total-apps">{{ apps|length }} applications</span>
        <span class="running-count">{{ apps|selectattr('container_status', 'equalto', 'running')|list|length }} running</span>
        <span class="error-count">{{ apps|selectattr('container_status', 'equalto', 'error')|list|length }} errors</span>
    </div>
    
    <div class="bulk-actions">
        <button class="btn-sm btn-success"
                hx-post="/api/docker/{{ model_slug }}/bulk/start"
                hx-target="closest .model-content"
                hx-confirm="Start all applications for this model?"
                _="on click add .loading to me">
            ‚ñ∂Ô∏è Start All
        </button>
        
        <button class="btn-sm btn-danger"
                hx-post="/api/docker/{{ model_slug }}/bulk/stop"
                hx-target="closest .model-content"
                hx-confirm="Stop all applications for this model?"
                _="on click add .loading to me">
            ‚èπÔ∏è Stop All
        </button>
        
        <button class="btn-sm btn-primary"
                hx-post="/api/analysis/{{ model_slug }}/bulk/security"
                hx-target="#app-test-modal .modal-content"
                _="on click show #app-test-modal">
            üîí Bulk Security Test
        </button>
    </div>
</div>

<!-- Empty State for Apps -->
{% if not apps %}
<div class="apps-empty">
    <div class="empty-icon">üì±</div>
    <h4>No Applications Found</h4>
    <p>This model doesn't have any generated applications yet.</p>
    <button class="btn-primary"
            hx-post="/api/generate/{{ model_slug }}/apps"
            hx-target="closest .model-content"
            hx-confirm="Generate applications for this model?">
        Generate Apps
    </button>
</div>
{% endif %}
