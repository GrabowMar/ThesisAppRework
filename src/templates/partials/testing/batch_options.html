<!-- Batch Configuration Options -->
<div class="batch-options">
    <div class="row">
        <!-- Execution Settings -->
        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header">
                    <h6 class="mb-0"><i class="fas fa-play me-2"></i>Execution Settings</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="batch_size" class="form-label">Batch Size</label>
                        <input type="number" name="batch_size" id="batch_size" class="form-control" 
                               min="1" max="10" value="3">
                        <div class="form-text">Number of parallel executions</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="execution_mode" class="form-label">Execution Mode</label>
                        <select name="execution_mode" id="execution_mode" class="form-select">
                            <option value="parallel">Parallel</option>
                            <option value="sequential">Sequential</option>
                            <option value="adaptive">Adaptive (Based on Load)</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="priority" class="form-label">Priority</label>
                        <select name="priority" id="priority" class="form-select">
                            <option value="normal">Normal</option>
                            <option value="high">High</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Timeout & Resource Settings -->
        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header">
                    <h6 class="mb-0"><i class="fas fa-clock me-2"></i>Timeout & Resources</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="timeout" class="form-label">Timeout (minutes)</label>
                        <input type="number" name="timeout" id="timeout" class="form-control" 
                               min="1" max="120" value="30">
                        <div class="form-text">Maximum execution time per test</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="memory_limit" class="form-label">Memory Limit (MB)</label>
                        <input type="number" name="memory_limit" id="memory_limit" class="form-control" 
                               min="128" max="4096" value="512" step="128">
                    </div>
                    
                    <div class="mb-3">
                        <label for="cpu_limit" class="form-label">CPU Limit (%)</label>
                        <input type="number" name="cpu_limit" id="cpu_limit" class="form-control" 
                               min="10" max="100" value="80" step="10">
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification & Reporting -->
    <div class="row">
        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header">
                    <h6 class="mb-0"><i class="fas fa-bell me-2"></i>Notifications</h6>
                </div>
                <div class="card-body">
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" name="notify_on_start" id="notify_on_start">
                        <label class="form-check-label" for="notify_on_start">
                            Notify on batch start
                        </label>
                    </div>
                    
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" name="notify_on_completion" id="notify_on_completion" checked>
                        <label class="form-check-label" for="notify_on_completion">
                            Notify on completion
                        </label>
                    </div>
                    
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" name="notify_on_failure" id="notify_on_failure" checked>
                        <label class="form-check-label" for="notify_on_failure">
                            Notify on failures
                        </label>
                    </div>
                    
                    <div class="mb-3">
                        <label for="notification_email" class="form-label">Email (optional)</label>
                        <input type="email" name="notification_email" id="notification_email" class="form-control" 
                               placeholder="user@example.com">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header">
                    <h6 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Reporting</h6>
                </div>
                <div class="card-body">
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" name="generate_summary" id="generate_summary" checked>
                        <label class="form-check-label" for="generate_summary">
                            Generate summary report
                        </label>
                    </div>
                    
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" name="include_logs" id="include_logs">
                        <label class="form-check-label" for="include_logs">
                            Include detailed logs
                        </label>
                    </div>
                    
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" name="export_csv" id="export_csv">
                        <label class="form-check-label" for="export_csv">
                            Export results to CSV
                        </label>
                    </div>
                    
                    <div class="mb-3">
                        <label for="report_format" class="form-label">Report Format</label>
                        <select name="report_format" id="report_format" class="form-select">
                            <option value="html">HTML</option>
                            <option value="pdf">PDF</option>
                            <option value="json">JSON</option>
                            <option value="both">HTML + PDF</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Retry & Error Handling -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0"><i class="fas fa-redo me-2"></i>Error Handling & Retry Policy</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="max_retries" class="form-label">Max Retries</label>
                                <input type="number" name="max_retries" id="max_retries" class="form-control" 
                                       min="0" max="5" value="2">
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="retry_delay" class="form-label">Retry Delay (seconds)</label>
                                <input type="number" name="retry_delay" id="retry_delay" class="form-control" 
                                       min="5" max="300" value="30" step="5">
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="failure_threshold" class="form-label">Failure Threshold (%)</label>
                                <input type="number" name="failure_threshold" id="failure_threshold" class="form-control" 
                                       min="0" max="100" value="20" step="5">
                                <div class="form-text">Stop batch if failure rate exceeds this</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="continue_on_error" id="continue_on_error" checked>
                                <label class="form-check-label" for="continue_on_error">
                                    Continue batch on individual test failures
                                </label>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="cleanup_on_failure" id="cleanup_on_failure" checked>
                                <label class="form-check-label" for="cleanup_on_failure">
                                    Clean up resources on failure
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Batch configuration validation
document.getElementById('batch_size').addEventListener('change', function() {
    const value = parseInt(this.value);
    if (value > 5) {
        this.classList.add('is-warning');
        showTooltip(this, 'High batch sizes may impact system performance');
    } else {
        this.classList.remove('is-warning');
    }
});

// Dynamic timeout adjustment based on tools
function adjustTimeoutForTools() {
    const selectedTools = document.querySelectorAll('input[name="selected_tools"]:checked');
    const timeoutInput = document.getElementById('timeout');
    let suggestedTimeout = 30; // base timeout
    
    selectedTools.forEach(tool => {
        switch(tool.value) {
            case 'zap':
                suggestedTimeout += 20; // ZAP takes longer
                break;
            case 'performance':
                suggestedTimeout += 15; // Performance tests are lengthy
                break;
            case 'ai_analyzer':
                suggestedTimeout += 10; // AI analysis takes time
                break;
            default:
                suggestedTimeout += 5;
        }
    });
    
    if (timeoutInput.value == 30) { // Only suggest if user hasn't customized
        timeoutInput.value = Math.min(suggestedTimeout, 120);
    }
}

// Memory limit suggestions
document.getElementById('memory_limit').addEventListener('focus', function() {
    const selectedTools = document.querySelectorAll('input[name="selected_tools"]:checked');
    let suggestedMemory = 512;
    
    if (Array.from(selectedTools).some(tool => tool.value === 'ai_analyzer')) {
        suggestedMemory = 1024;
    }
    
    showTooltip(this, `Suggested: ${suggestedMemory}MB based on selected tools`);
});

function showTooltip(element, message) {
    // Simple tooltip implementation
    element.title = message;
}
</script>
