<!-- AI Analysis Results -->
<div class="ai-results" data-tool="ai_analyzer">
    <div class="row">
        <!-- Summary Statistics -->
        <div class="col-md-12">
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-brain me-2"></i>AI Analysis Summary</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="stat-card text-center">
                                <h3 class="text-info">{{ ai_results.total_insights or 0 }}</h3>
                                <p class="mb-0">Total Insights</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card text-center">
                                <h3 class="text-danger">{{ ai_results.critical_issues or 0 }}</h3>
                                <p class="mb-0">Critical Issues</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card text-center">
                                <h3 class="text-success">{{ ai_results.improvements or 0 }}</h3>
                                <p class="mb-0">Improvements</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card text-center">
                                <h3 class="text-warning">{{ ai_results.files_analyzed or 0 }}</h3>
                                <p class="mb-0">Files Analyzed</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-4">
                            <div class="progress-group">
                                <label>Code Quality Score</label>
                                <div class="progress">
                                    <div class="progress-bar bg-{{ 'success' if ai_results.quality_score >= 80 else ('warning' if ai_results.quality_score >= 60 else 'danger') }}" 
                                         data-width="{{ ai_results.quality_score or 0 }}">
                                        {{ ai_results.quality_score or 0 }}%
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="progress-group">
                                <label>Security Score</label>
                                <div class="progress">
                                    <div class="progress-bar bg-{{ 'success' if ai_results.security_score >= 80 else ('warning' if ai_results.security_score >= 60 else 'danger') }}" 
                                         data-width="{{ ai_results.security_score or 0 }}">
                                        {{ ai_results.security_score or 0 }}%
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="progress-group">
                                <label>Analysis Model</label>
                                <p class="mb-0"><strong>{{ ai_results.model_used or 'N/A' }}</strong></p>
                                <small class="text-muted">Tokens: {{ ai_results.tokens_used or 'N/A' }}</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Analysis Categories -->
    <div class="row">
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">Issue Categories</h6>
                </div>
                <div class="card-body">
                    <canvas id="aiCategoriesChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">Severity Distribution</h6>
                </div>
                <div class="card-body">
                    <canvas id="aiSeverityChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <!-- AI Insights Tabs -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs" id="aiInsightsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="security-insights-tab" data-bs-toggle="tab" 
                                    data-bs-target="#security-insights" type="button" role="tab">
                                <i class="fas fa-shield-alt me-1"></i>Security Insights
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="quality-insights-tab" data-bs-toggle="tab" 
                                    data-bs-target="#quality-insights" type="button" role="tab">
                                <i class="fas fa-code me-1"></i>Code Quality
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="performance-insights-tab" data-bs-toggle="tab" 
                                    data-bs-target="#performance-insights" type="button" role="tab">
                                <i class="fas fa-tachometer-alt me-1"></i>Performance
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="best-practices-tab" data-bs-toggle="tab" 
                                    data-bs-target="#best-practices" type="button" role="tab">
                                <i class="fas fa-star me-1"></i>Best Practices
                            </button>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content" id="aiInsightsTabContent">
                        <!-- Security Insights -->
                        <div class="tab-pane fade show active" id="security-insights" role="tabpanel">
                            {% if ai_results.security_insights %}
                            <div class="insights-list">
                                {% for insight in ai_results.security_insights %}
                                <div class="insight-item mb-4 p-4 border rounded 
                                     border-{{ 'danger' if insight.severity == 'critical' else ('warning' if insight.severity == 'high' else 'info') }}">
                                    <div class="d-flex justify-content-between align-items-start mb-3">
                                        <h6 class="text-{{ 'danger' if insight.severity == 'critical' else ('warning' if insight.severity == 'high' else 'info') }}">
                                            <i class="fas fa-{{ 'exclamation-triangle' if insight.severity == 'critical' else ('shield-alt' if insight.severity == 'high' else 'info-circle') }} me-2"></i>
                                            {{ insight.title }}
                                        </h6>
                                        <span class="badge bg-{{ 'danger' if insight.severity == 'critical' else ('warning' if insight.severity == 'high' else 'info') }}">
                                            {{ insight.severity | title }}
                                        </span>
                                    </div>
                                    
                                    <p class="mb-3">{{ insight.description }}</p>
                                    
                                    {% if insight.affected_files %}
                                    <div class="mb-3">
                                        <small class="text-muted">Affected Files:</small>
                                        <div class="mt-1">
                                            {% for file in insight.affected_files %}
                                            <span class="badge bg-light text-dark me-1">{{ file }}</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endif %}
                                    
                                    {% if insight.code_example %}
                                    <div class="mb-3">
                                        <small class="text-muted">Code Example:</small>
                                        <pre class="mt-2 p-2 bg-light rounded"><code class="language-python">{{ insight.code_example }}</code></pre>
                                    </div>
                                    {% endif %}
                                    
                                    {% if insight.recommendation %}
                                    <div class="recommendation-box p-3 bg-light rounded">
                                        <strong>Recommendation:</strong>
                                        <p class="mb-0 mt-1">{{ insight.recommendation }}</p>
                                        {% if insight.fix_example %}
                                        <details class="mt-2">
                                            <summary class="btn btn-sm btn-outline-success">Show Fix Example</summary>
                                            <pre class="mt-2 p-2 bg-success bg-opacity-10 rounded"><code class="language-python">{{ insight.fix_example }}</code></pre>
                                        </details>
                                        {% endif %}
                                    </div>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                            {% else %}
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle me-2"></i>
                                No security issues identified by AI analysis.
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Code Quality Insights -->
                        <div class="tab-pane fade" id="quality-insights" role="tabpanel">
                            {% if ai_results.quality_insights %}
                            <div class="insights-list">
                                {% for insight in ai_results.quality_insights %}
                                <div class="insight-item mb-4 p-4 border rounded border-primary">
                                    <div class="d-flex justify-content-between align-items-start mb-3">
                                        <h6 class="text-primary">
                                            <i class="fas fa-code me-2"></i>{{ insight.title }}
                                        </h6>
                                        <span class="badge bg-primary">Quality</span>
                                    </div>
                                    
                                    <p class="mb-3">{{ insight.description }}</p>
                                    
                                    {% if insight.metrics %}
                                    <div class="metrics-display mb-3">
                                        <small class="text-muted">Quality Metrics:</small>
                                        <div class="row mt-2">
                                            {% for metric_name, metric_value in insight.metrics.items() %}
                                            <div class="col-md-3">
                                                <div class="metric-card text-center p-2 bg-light rounded">
                                                    <strong>{{ metric_value }}</strong>
                                                    <br>
                                                    <small>{{ metric_name | replace('_', ' ') | title }}</small>
                                                </div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endif %}
                                    
                                    {% if insight.improvement_suggestions %}
                                    <div class="improvements-box p-3 bg-light rounded">
                                        <strong>Improvement Suggestions:</strong>
                                        <ul class="mb-0 mt-1">
                                            {% for suggestion in insight.improvement_suggestions %}
                                            <li>{{ suggestion }}</li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                            {% else %}
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                No specific code quality insights available.
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Performance Insights -->
                        <div class="tab-pane fade" id="performance-insights" role="tabpanel">
                            {% if ai_results.performance_insights %}
                            <div class="insights-list">
                                {% for insight in ai_results.performance_insights %}
                                <div class="insight-item mb-4 p-4 border rounded border-success">
                                    <div class="d-flex justify-content-between align-items-start mb-3">
                                        <h6 class="text-success">
                                            <i class="fas fa-tachometer-alt me-2"></i>{{ insight.title }}
                                        </h6>
                                        <span class="badge bg-{{ 'danger' if insight.impact == 'high' else ('warning' if insight.impact == 'medium' else 'success') }}">
                                            {{ insight.impact | title }} Impact
                                        </span>
                                    </div>
                                    
                                    <p class="mb-3">{{ insight.description }}</p>
                                    
                                    {% if insight.performance_bottlenecks %}
                                    <div class="bottlenecks-list mb-3">
                                        <small class="text-muted">Identified Bottlenecks:</small>
                                        <ul class="mt-1">
                                            {% for bottleneck in insight.performance_bottlenecks %}
                                            <li>{{ bottleneck }}</li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                    {% endif %}
                                    
                                    {% if insight.optimization_suggestions %}
                                    <div class="optimizations-box p-3 bg-light rounded">
                                        <strong>Optimization Suggestions:</strong>
                                        <ol class="mb-0 mt-1">
                                            {% for suggestion in insight.optimization_suggestions %}
                                            <li>{{ suggestion }}</li>
                                            {% endfor %}
                                        </ol>
                                    </div>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                            {% else %}
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                No performance insights available.
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Best Practices -->
                        <div class="tab-pane fade" id="best-practices" role="tabpanel">
                            {% if ai_results.best_practices %}
                            <div class="insights-list">
                                {% for practice in ai_results.best_practices %}
                                <div class="insight-item mb-4 p-4 border rounded border-warning">
                                    <div class="d-flex justify-content-between align-items-start mb-3">
                                        <h6 class="text-warning">
                                            <i class="fas fa-star me-2"></i>{{ practice.title }}
                                        </h6>
                                        <span class="badge bg-{{ 'success' if practice.compliance == 'good' else ('warning' if practice.compliance == 'partial' else 'danger') }}">
                                            {{ practice.compliance | title }}
                                        </span>
                                    </div>
                                    
                                    <p class="mb-3">{{ practice.description }}</p>
                                    
                                    {% if practice.violations %}
                                    <div class="violations-list mb-3">
                                        <small class="text-muted">Violations Found:</small>
                                        <ul class="mt-1">
                                            {% for violation in practice.violations %}
                                            <li>{{ violation }}</li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                    {% endif %}
                                    
                                    {% if practice.recommendations %}
                                    <div class="recommendations-box p-3 bg-light rounded">
                                        <strong>Recommendations:</strong>
                                        <ul class="mb-0 mt-1">
                                            {% for recommendation in practice.recommendations %}
                                            <li>{{ recommendation }}</li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                            {% else %}
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                No best practices analysis available.
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Overall Assessment -->
    {% if ai_results.overall_assessment %}
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-dark text-white">
                    <h6 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Overall Assessment</h6>
                </div>
                <div class="card-body">
                    <div class="assessment-summary">
                        <div class="row">
                            <div class="col-md-8">
                                <h6>Summary</h6>
                                <p>{{ ai_results.overall_assessment.summary }}</p>
                                
                                {% if ai_results.overall_assessment.key_findings %}
                                <h6>Key Findings</h6>
                                <ul>
                                    {% for finding in ai_results.overall_assessment.key_findings %}
                                    <li>{{ finding }}</li>
                                    {% endfor %}
                                </ul>
                                {% endif %}
                            </div>
                            <div class="col-md-4">
                                <div class="assessment-scores">
                                    <div class="score-item mb-3">
                                        <label>Overall Health</label>
                                        <div class="progress">
                                            <div class="progress-bar bg-success" data-width="{{ ai_results.overall_assessment.health_score or 0 }}">
                                                {{ ai_results.overall_assessment.health_score or 0 }}%
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="score-item mb-3">
                                        <label>Maintainability</label>
                                        <div class="progress">
                                            <div class="progress-bar bg-info" data-width="{{ ai_results.overall_assessment.maintainability_score or 0 }}">
                                                {{ ai_results.overall_assessment.maintainability_score or 0 }}%
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="score-item">
                                        <label>Technical Debt</label>
                                        <div class="progress">
                                            <div class="progress-bar bg-warning" data-width="{{ ai_results.overall_assessment.technical_debt or 0 }}">
                                                {{ ai_results.overall_assessment.technical_debt or 0 }}%
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script>
// AI results specific JavaScript
document.addEventListener('DOMContentLoaded', function() {
    if (typeof aiResults !== 'undefined') {
        initializeAICharts();
        animateProgressBars();
    }
    
    // Syntax highlighting for code examples
    if (typeof Prism !== 'undefined') {
        Prism.highlightAll();
    }
});

function initializeAICharts() {
    // Categories Chart
    const categoriesCtx = document.getElementById('aiCategoriesChart');
    if (categoriesCtx && aiResults.categories) {
        new Chart(categoriesCtx, {
            type: 'doughnut',
            data: {
                labels: Object.keys(aiResults.categories),
                datasets: [{
                    data: Object.values(aiResults.categories),
                    backgroundColor: [
                        '#dc3545', '#ffc107', '#28a745', '#17a2b8', 
                        '#6f42c1', '#fd7e14', '#20c997'
                    ]
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    }
    
    // Severity Chart
    const severityCtx = document.getElementById('aiSeverityChart');
    if (severityCtx && aiResults.severity_distribution) {
        new Chart(severityCtx, {
            type: 'bar',
            data: {
                labels: ['Critical', 'High', 'Medium', 'Low'],
                datasets: [{
                    data: [
                        aiResults.severity_distribution.critical || 0,
                        aiResults.severity_distribution.high || 0,
                        aiResults.severity_distribution.medium || 0,
                        aiResults.severity_distribution.low || 0
                    ],
                    backgroundColor: ['#dc3545', '#fd7e14', '#ffc107', '#17a2b8']
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }
}

function animateProgressBars() {
    // Animate progress bars with data-width attributes
    const progressBars = document.querySelectorAll('.progress-bar[data-width]');
    progressBars.forEach(bar => {
        const width = bar.getAttribute('data-width');
        setTimeout(() => {
            bar.style.width = width + '%';
        }, 100);
    });
}

// Export functions for external use
window.aiResultsFunctions = {
    initializeAICharts: initializeAICharts,
    animateProgressBars: animateProgressBars
};
</script>
