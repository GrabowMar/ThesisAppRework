<!-- Security Testing Jobs List Partial -->
{% if jobs %}
<div class="table-responsive">
    <table class="table table-hover mb-0">
        <thead class="table-dark">
            <tr>
                <th>Test ID</th>
                <th>Type</th>
                <th>Target</th>
                <th>Status</th>
                <th>Started</th>
                <th>Duration</th>
                <th>Issues Found</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for job in jobs %}
            <tr class="test-row">
                <td>
                    <small class="text-monospace">{{ job.job_id[:8] }}...</small>
                </td>
                <td>
                    {% if job.test_type == 'security_analysis' %}
                        <span class="badge badge-primary">
                            <i class="fas fa-shield-alt mr-1"></i>
                            Security Analysis
                        </span>
                    {% elif job.test_type == 'zap_scan' %}
                        <span class="badge badge-warning">
                            <i class="fas fa-spider mr-1"></i>
                            ZAP Scan
                        </span>
                    {% elif job.test_type == 'performance_test' %}
                        <span class="badge badge-info">
                            <i class="fas fa-tachometer-alt mr-1"></i>
                            Performance Test
                        </span>
                    {% elif job.test_type == 'ai_analysis' %}
                        <span class="badge badge-success">
                            <i class="fas fa-robot mr-1"></i>
                            AI Analysis
                        </span>
                    {% else %}
                        <span class="badge badge-secondary">{{ job.test_type|title }}</span>
                    {% endif %}
                </td>
                <td>
                    <div class="d-flex flex-column">
                        <span class="font-weight-bold">{{ job.model }}</span>
                        <small class="text-muted">App {{ job.app_num }}</small>
                        {% if job.target_url %}
                        <small class="text-info">{{ job.target_url }}</small>
                        {% endif %}
                    </div>
                </td>
                <td>
                    {% if job.status == 'pending' %}
                        <span class="badge badge-secondary test-status-pending">
                            <i class="fas fa-clock mr-1"></i>
                            Pending
                        </span>
                    {% elif job.status == 'running' %}
                        <span class="badge badge-primary test-status-running">
                            <i class="fas fa-spinner fa-spin mr-1"></i>
                            Running
                        </span>
                    {% elif job.status == 'completed' %}
                        <span class="badge badge-success test-status-completed">
                            <i class="fas fa-check mr-1"></i>
                            Completed
                        </span>
                    {% elif job.status == 'failed' %}
                        <span class="badge badge-danger test-status-failed">
                            <i class="fas fa-times mr-1"></i>
                            Failed
                        </span>
                    {% elif job.status == 'cancelled' %}
                        <span class="badge badge-warning test-status-cancelled">
                            <i class="fas fa-ban mr-1"></i>
                            Cancelled
                        </span>
                    {% endif %}
                </td>
                <td>
                    {% if job.created_at %}
                        <small class="text-muted">{{ job.created_at.strftime('%Y-%m-%d %H:%M') if job.created_at.strftime else job.created_at }}</small>
                    {% else %}
                        <small class="text-muted">Unknown</small>
                    {% endif %}
                </td>
                <td>
                    {% if job.status == 'running' and job.runtime_seconds %}
                        <small class="text-info">{{ "%.0f"|format(job.runtime_seconds) }}s</small>
                    {% elif job.duration %}
                        <small class="text-success">{{ "%.1f"|format(job.duration) }}s</small>
                    {% else %}
                        <small class="text-muted">-</small>
                    {% endif %}
                </td>
                <td>
                    {% if job.status == 'completed' %}
                        {% if job.total_issues %}
                            <span class="badge badge-danger vuln-count">{{ job.total_issues }}</span>
                        {% else %}
                            <span class="badge badge-success vuln-count">0</span>
                        {% endif %}
                        {% if job.tools_used %}
                            <br><small class="text-muted">{{ job.tools_used|join(', ') }}</small>
                        {% endif %}
                    {% else %}
                        <small class="text-muted">-</small>
                    {% endif %}
                </td>
                <td>
                    <div class="btn-group-sm">
                        <button type="button" class="btn btn-outline-info btn-sm" 
                                onclick="showTestDetails('{{ job.job_id }}')"
                                title="View Details">
                            <i class="fas fa-info-circle"></i>
                        </button>
                        
                        {% if job.status == 'completed' %}
                            <button type="button" class="btn btn-outline-success btn-sm" 
                                    onclick="showTestResults('{{ job.job_id }}')"
                                    title="View Results">
                                <i class="fas fa-chart-bar"></i>
                            </button>
                        {% endif %}
                        
                        {% if job.status in ['pending', 'running'] %}
                            <button type="button" class="btn btn-outline-warning btn-sm" 
                                    onclick="cancelTest('{{ job.job_id }}', this)"
                                    title="Cancel Test">
                                <i class="fas fa-stop"></i>
                            </button>
                        {% endif %}
                        
                        {% if job.status in ['completed', 'failed', 'cancelled'] %}
                            <button type="button" class="btn btn-outline-danger btn-sm" 
                                    onclick="deleteTest('{{ job.job_id }}', this)"
                                    title="Delete Test">
                                <i class="fas fa-trash"></i>
                            </button>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="text-center py-5">
    <i class="fas fa-shield-alt fa-3x text-muted mb-3"></i>
    <h5 class="text-muted">No Security Tests Found</h5>
    <p class="text-muted">Create your first security test to get started with automated vulnerability analysis.</p>
    <button type="button" class="btn btn-primary" onclick="showCreateTestModal()">
        <i class="fas fa-plus mr-1"></i>
        Create Security Test
    </button>
</div>
{% endif %}
