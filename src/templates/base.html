<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{% block meta_description %}Thesis Research App - AI-generated application analysis and security testing{% endblock %}">
    <meta name="author" content="Thesis Research Team">
    
    <title>{% block title %}Thesis Research App{% endblock %}</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='img/logo.svg') }}">
    
    <!-- Missing.css Framework -->
    <link rel="stylesheet" href="https://unpkg.com/missing.css@1.1.3">
    <!-- Optional: Prism theme for code highlighting -->
    <link rel="stylesheet" href="https://unpkg.com/missing.css@1.1.3/prism">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <!-- Additional head content -->
    {% block head %}{% endblock %}
    
    <!-- HTMX Configuration -->
    <script>
        // Configure HTMX
        htmx.config.defaultSwapStyle = 'innerHTML';
        htmx.config.defaultSwapDelay = 0;
        htmx.config.defaultSettleDelay = 20;
        htmx.config.requestClass = 'htmx-request';
        htmx.config.addedClass = 'htmx-added';
        htmx.config.settlingClass = 'htmx-settling';
        htmx.config.swappingClass = 'htmx-swapping';
        
        // Global HTMX error handler
        document.body.addEventListener('htmx:responseError', function(e) {
            console.error('HTMX Error:', e.detail);
            if (window.showToast) {
                window.showToast('Request failed. Please try again.', 'error');
            }
        });
    </script>
</head>
<body class="{% block body_class %}{% endblock %}">
    <!-- Skip navigation for accessibility -->
    <a href="#main-content" class="sr-only">Skip to main content</a>
    
    <!-- Application Layout -->
    {% block layout %}
        {% include 'layouts/main_layout.html' %}
    {% endblock %}
    
    <!-- Toast Container for notifications -->
    <div class="toast-container" aria-live="polite" aria-atomic="true"></div>
    
    <!-- Screen Reader Announcer -->
    <div id="sr-announcer" aria-live="polite" aria-atomic="true" class="sr-only"></div>
    
    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    
    <!-- Page-specific JavaScript -->
    {% block scripts %}{% endblock %}
    
    <!-- Application Initialization -->
    <script>
        // Global configuration
        window.APP_CONFIG = {
            apiBase: '{{ request.url_root }}api/',
            currentUser: {{ current_user.to_dict() | tojson if current_user and current_user.is_authenticated else 'null' }},
            debug: {{ config.DEBUG | tojson }},
            version: '2.0.0'
        };
        
        // Initialize HTMX indicators
        document.addEventListener('DOMContentLoaded', function() {
            // Add global loading indicator
            const loadingHtml = `
                <div class="htmx-indicator loading" id="global-loading">
                    <div class="loading-spinner"></div>
                    <span>Loading...</span>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', loadingHtml);
        });
    </script>
    
    <!-- Development tools -->
    {% if config.DEBUG %}
    <script>
        // HTMX debugging
        htmx.logAll();
        
        // Performance monitoring
        let htmxRequestStart = null;
        document.body.addEventListener('htmx:beforeRequest', function(e) {
            htmxRequestStart = performance.now();
            console.log('HTMX Request started:', e.detail.requestConfig.verb, e.detail.requestConfig.path);
        });
        
        document.body.addEventListener('htmx:afterRequest', function(e) {
            if (htmxRequestStart) {
                const duration = performance.now() - htmxRequestStart;
                console.log(`HTMX Request completed in ${duration.toFixed(2)}ms`);
            }
        });
    </script>
    {% endif %}
</body>
</html>
