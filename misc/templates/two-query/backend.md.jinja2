# Generate Backend: {{ name }}

{{ description }}

## Requirements

### User Features
{% for req in backend_requirements %}
- {{ req }}
{% endfor %}

### Admin Features  
{% for req in admin_requirements %}
- {{ req }}
{% endfor %}

{% if api_endpoints %}
## API Endpoints
{{ api_endpoints }}
{% endif %}

{% if admin_api_endpoints %}
## Admin API Endpoints
{{ admin_api_endpoints }}
{% endif %}

## Data Model
{% if data_model %}
**{{ data_model.name }}**: {% for field, type in data_model.fields.items() %}{{ field }} ({{ type }}){% if not loop.last %}, {% endif %}{% endfor %}
{% endif %}

## MANDATORY: Authentication System

Implement JWT authentication with these endpoints:
- POST /api/auth/register - Create user account
- POST /api/auth/login - Login, return JWT token  
- GET /api/auth/me - Get current user (token required)

Include User model with: id, username, password_hash, is_admin, is_active, created_at

Auth response requirements:
- /api/auth/register MUST return { "token": "...", "user": { ... } }
- /api/auth/login MUST return { "token": "...", "user": { ... } }
- /api/auth/me MUST return the user object

Use a stable secret key:
- app.config['SECRET_KEY'] = os.environ.get('SECRET_KEY', 'dev-secret-key')
- DO NOT use os.urandom for SECRET_KEY

## Stack
- Flask 3.x + Flask-SQLAlchemy 3.1+
- SQLite: `sqlite:////app/data/app.db`
- bcrypt for passwords, PyJWT for tokens

## SINGLE FILE OUTPUT

Generate ONE complete app.py file with ALL code:
- Models (User + app-specific)
- Auth helpers (token_required, admin_required decorators)
- Auth routes (/api/auth/*)
- User routes (/api/*)
- Admin routes (/api/admin/*)

## Code Patterns

### Auth Decorator
```python
def token_required(f):
    @wraps(f)
    def decorated(*args, **kwargs):
        token = request.headers.get('Authorization', '').replace('Bearer ', '')
        if not token: return jsonify({'error': 'Token required'}), 401
        try:
            data = jwt.decode(token, SECRET, algorithms=['HS256'])
            user = User.query.get(data['user_id'])
            if not user: return jsonify({'error': 'Invalid user'}), 401
        except: return jsonify({'error': 'Invalid token'}), 401
        return f(user, *args, **kwargs)
    return decorated
```

### Response Format
```python
return jsonify(item.to_dict()), 200
return jsonify({'items': [i.to_dict() for i in items]}), 200
return jsonify({'error': 'Not found'}), 404
```

## Output Format

Generate ONE file only:

```python:app.py
# Complete Flask application with all models, auth, and routes
```

If you need additional dependencies, add a requirements block:
```requirements
package-name==1.0.0
```

Generate complete, working code. No placeholders. No explanations.


