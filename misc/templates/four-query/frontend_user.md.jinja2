# Generate {{ name }} - Frontend Application

{{ description }}

## Your Task
Generate a **COMPLETE SINGLE-FILE React application** in `App.jsx` containing ALL frontend code:
- All imports at the top
- API client setup with axios
- Authentication context and hooks (AuthContext, AuthProvider, useAuth)
- All page components (HomePage, LoginPage, RegisterPage)
- Navigation component
- ProtectedRoute component
- Main App component with routing
- Everything in ONE file - NO separate files

## TL;DR
- Generate ONE App.jsx file with ALL code (~600-900 lines)
- HomePage serves both public and logged-in users via conditional rendering
- Public users: read-only view of ALL content with "Sign in" CTAs
- Logged-in users: same content + create/edit/delete + additional features
- Use pattern: `{isAuthenticated ? <EditButton /> : <SignInCTA />}`

## User Requirements
{% for req in frontend_requirements %}
- {{ req }}
{% endfor %}

## Access Policy (MANDATORY)
- HomePage displays **ALL content in read-only mode** for public users (no auth required)
- Public users fetch data from the SAME endpoints as logged-in users
- Conditional rendering based on `isAuthenticated`:
  - Public: Show items with "Sign in to manage" CTAs instead of action buttons
  - Logged-in: Show items with create/edit/delete buttons + forms
- Same layout, same data, different interactive elements

{% if api_endpoints %}
## Backend API Available
{{ api_endpoints }}
{% endif %}

## Stack & Constraints
- React 18 + Tailwind CSS
- Axios for API calls (baseURL: `/api` or `VITE_BACKEND_URL/api`)
- react-hot-toast for notifications
- react-router-dom for routing (DO NOT wrap in BrowserRouter - main.jsx provides it)
- All code in ONE App.jsx file

## CRITICAL: SINGLE FILE OUTPUT

**YOU MUST generate ONE complete App.jsx file containing ALL code.**

DO NOT split into multiple files. DO NOT generate separate pages/, services/, or hooks/ files.
Everything goes in ONE App.jsx file.

## File Structure (Internal to App.jsx)

The code MUST be organized in this order:

```jsx
// 1. All imports
import React, { useState, useEffect, createContext, useContext } from 'react';
import { Routes, Route, Link, Navigate, useNavigate } from 'react-router-dom';
import axios from 'axios';
import toast from 'react-hot-toast';
// ... other imports

// 2. API Client Setup
const baseURL = import.meta.env.VITE_BACKEND_URL
  ? `${import.meta.env.VITE_BACKEND_URL.replace(/\/$/, '')}/api`
  : '/api';

const api = axios.create({ baseURL, headers: { 'Content-Type': 'application/json' } });

api.interceptors.request.use(config => {
  const token = localStorage.getItem('token');
  if (token) config.headers.Authorization = `Bearer ${token}`;
  return config;
});

// 3. AuthContext and AuthProvider
const AuthContext = createContext(null);

function AuthProvider({ children }) {
  // Auth state and methods
  // ...
}

const useAuth = () => useContext(AuthContext);

// 4. Utility Components
function LoadingSpinner() { /* ... */ }
function ProtectedRoute({ children, adminOnly }) { /* ... */ }

// 5. Navigation
function Navigation() { /* Links: Home, Admin (if admin), Login/Logout */ }

// 6. Page Components
function HomePage() {
  /* Main app page with conditional rendering:
     - Fetch ALL data (public endpoint, no auth)
     - Show read-only view for public users
     - Show same data + create/edit/delete for logged-in users
     - Use {isAuthenticated ? <actions> : <CTAs>}
  */
}

function LoginPage() { /* Login form, redirects to / */ }
function RegisterPage() { /* Register form, redirects to / */ }

// 7. Main App Component (NO BrowserRouter - main.jsx provides it)
function App() {
  return (
    <AuthProvider>
      <div className="min-h-screen bg-gray-50">
        <Navigation />
        <main className="container mx-auto px-4 py-8">
          <Routes>
            <Route path="/" element={<HomePage />} />
            <Route path="/login" element={<LoginPage />} />
            <Route path="/register" element={<RegisterPage />} />
          </Routes>
        </main>
      </div>
    </AuthProvider>
  );
}

export default App;
```

## Authentication Requirements (MANDATORY)

Implement complete JWT authentication:

1. **AuthContext** with:
   - State: `user`, `loading`
   - Methods: `login(username, password)`, `register(data)`, `logout()`
   - Auto-restore session from localStorage token on mount
   - Provide `isAuthenticated` (!!user) and `isAdmin` (user?.is_admin)

2. **LoginPage** with:
   - Username and password fields
   - Form validation
   - Error handling with toasts
   - Redirect to `/` on success
   - Link to register page

3. **RegisterPage** with:
   - Username, email, password, confirm password fields
   - Client-side validation (passwords match)
   - Error handling with toasts
   - Redirect to `/` on success
   - Link to login page

## HomePage Pattern (CRITICAL)

The HomePage MUST implement conditional rendering:

```jsx
function HomePage() {
  const { isAuthenticated, user } = useAuth();
  const [items, setItems] = useState([]);
  const [loading, setLoading] = useState(true);

  // Fetch data - works for EVERYONE (public endpoint)
  useEffect(() => {
    api.get('/items')
      .then(res => setItems(res.data.items || res.data))
      .catch(err => toast.error('Failed to load'))
      .finally(() => setLoading(false));
  }, []);

  // CRUD handlers - only for authenticated users
  const handleCreate = async (data) => {
    if (!isAuthenticated) {
      toast.error('Please sign in');
      return;
    }
    // ... create logic
  };

  if (loading) return <LoadingSpinner />;

  return (
    <div>
      <h1>{isAuthenticated ? `Welcome, ${user?.username}!` : 'Welcome!'}</h1>

      {/* Public CTA banner */}
      {!isAuthenticated && (
        <div className="bg-indigo-50 p-4 mb-4 rounded">
          <Link to="/login">Sign in</Link> to create and manage items.
        </div>
      )}

      {/* Conditional create button */}
      {isAuthenticated ? (
        <button onClick={() => setShowForm(true)}>Create New</button>
      ) : (
        <Link to="/login">Sign In to Create</Link>
      )}

      {/* Data display - SAME for everyone */}
      {items.map(item => (
        <div key={item.id}>
          <h3>{item.title}</h3>
          {/* Conditional actions */}
          {isAuthenticated && (
            <>
              <button onClick={() => handleEdit(item)}>Edit</button>
              <button onClick={() => handleDelete(item.id)}>Delete</button>
            </>
          )}
        </div>
      ))}
    </div>
  );
}
```

## Available Packages (DO NOT ADD OTHERS)

react, react-dom, react-router-dom, axios, react-hot-toast, @heroicons/react, date-fns, clsx, uuid

**If you need additional packages**, include a package.json block.

## Output Format

Generate EXACTLY ONE code block:

```jsx:App.jsx
// Complete React application - ALL code in this single file
// Approximately 600-900 lines of production-ready code

import React, { useState, useEffect, createContext, useContext } from 'react';
import { Routes, Route, Link, Navigate, useNavigate } from 'react-router-dom';
import axios from 'axios';
import toast from 'react-hot-toast';
// ... more imports if needed

// API CLIENT
const baseURL = import.meta.env.VITE_BACKEND_URL
  ? `${import.meta.env.VITE_BACKEND_URL.replace(/\/$/, '')}/api`
  : '/api';

const api = axios.create({ baseURL, headers: { 'Content-Type': 'application/json' } });

api.interceptors.request.use(config => {
  const token = localStorage.getItem('token');
  if (token) config.headers.Authorization = `Bearer ${token}`;
  return config;
});

// AUTH CONTEXT
const AuthContext = createContext(null);

function AuthProvider({ children }) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const token = localStorage.getItem('token');
    if (token) {
      api.get('/auth/me')
        .then(res => setUser(res.data))
        .catch(() => localStorage.removeItem('token'))
        .finally(() => setLoading(false));
    } else {
      setLoading(false);
    }
  }, []);

  const login = async (username, password) => {
    const res = await api.post('/auth/login', { username, password });
    localStorage.setItem('token', res.data.token);
    setUser(res.data.user);
    return res.data;
  };

  const register = async (data) => {
    const res = await api.post('/auth/register', data);
    localStorage.setItem('token', res.data.token);
    setUser(res.data.user);
    return res.data;
  };

  const logout = () => {
    localStorage.removeItem('token');
    setUser(null);
  };

  return (
    <AuthContext.Provider value={{ user, loading, login, register, logout, isAuthenticated: !!user }}>
      {children}
    </AuthContext.Provider>
  );
}

const useAuth = () => useContext(AuthContext);

// COMPONENTS
function LoadingSpinner() {
  return (
    <div className="flex items-center justify-center min-h-[200px]">
      <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
    </div>
  );
}

function Navigation() {
  const { user, isAuthenticated, logout } = useAuth();
  const navigate = useNavigate();

  const handleLogout = () => {
    logout();
    navigate('/login');
  };

  return (
    <nav className="bg-white shadow-sm border-b">
      <div className="container mx-auto px-4">
        <div className="flex items-center justify-between h-16">
          <Link to="/" className="text-xl font-bold text-indigo-600">App</Link>
          <div className="flex items-center gap-4">
            {isAuthenticated ? (
              <>
                <span className="text-gray-600">{user?.username}</span>
                <button onClick={handleLogout} className="text-gray-600 hover:text-gray-900">Logout</button>
              </>
            ) : (
              <>
                <Link to="/login" className="text-gray-600 hover:text-gray-900">Login</Link>
                <Link to="/register" className="text-indigo-600 hover:text-indigo-800">Register</Link>
              </>
            )}
          </div>
        </div>
      </div>
    </nav>
  );
}

// PAGES
function HomePage() {
  // IMPLEMENT: Main page with conditional rendering
  // Fetch ALL data (public endpoint)
  // Show read-only + CTAs for public
  // Show full CRUD for logged-in
}

function LoginPage() {
  // IMPLEMENT: Login form, redirect to /
}

function RegisterPage() {
  // IMPLEMENT: Register form, redirect to /
}

// MAIN APP
function App() {
  return (
    <AuthProvider>
      <div className="min-h-screen bg-gray-50">
        <Navigation />
        <main className="container mx-auto px-4 py-8">
          <Routes>
            <Route path="/" element={<HomePage />} />
            <Route path="/login" element={<LoginPage />} />
            <Route path="/register" element={<RegisterPage />} />
          </Routes>
        </main>
      </div>
    </AuthProvider>
  );
}

export default App;
```

## CRITICAL RULES

1. Generate ONE App.jsx file only - NO multiple files
2. NO placeholders, NO TODOs, NO "..." ellipsis, NO "// IMPLEMENT" comments
3. NO "Would you like me to continue?" - generate EVERYTHING
4. Every component MUST be fully implemented with real functionality
5. All CRUD operations must work
6. All forms must have validation
7. All API calls must have error handling
8. All user actions must show toast notifications
9. Loading states everywhere data is fetched
10. Empty states when no data exists

## Success Criteria

- ✅ ONE complete App.jsx file (600-900 lines)
- ✅ All requirements implemented
- ✅ HomePage works for both public and logged-in users
- ✅ Conditional rendering everywhere needed
- ✅ Complete auth system (login/register/logout)
- ✅ Loading/error/empty states throughout
- ✅ Toast notifications for all actions
- ✅ No placeholders or incomplete code

Generate the complete App.jsx file now. Do not include explanations.
