
<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h3 class="card-title mb-0">
      <i class="fas fa-file-lines me-2"></i>Application Logs
    </h3>
    <div class="card-actions">
      <div class="btn-group" role="group">
        <button class="btn btn-ghost-secondary btn-sm" 
                hx-get="/applications/anthropic_claude-3-5-haiku/1/section/logs"
                hx-target="#section-logs"
                hx-swap="innerHTML"
                title="Refresh logs">
          <i class="fas fa-sync"></i>
        </button>
        <button class="btn btn-ghost-primary btn-sm" onclick="toggleAutoRefresh()" id="auto-refresh-btn" title="Toggle auto-refresh">
          <i class="fas fa-pause"></i>
        </button>
        <button class="btn btn-ghost-info btn-sm" onclick="clearLogs()" title="Clear logs">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>
  </div>
  <div class="card-body">
    
      <div class="text-center text-muted py-4">
        <i class="fas fa-file-lines fa-3x mb-3"></i>
        <h4>No Logs Available</h4>
        <p>The application container is not running or has not generated any logs yet.</p>
        
      </div>
    
  </div>
</div>

<script>
let autoRefreshInterval;
let isAutoRefreshing = true;

// Initialize auto-refresh
document.addEventListener('DOMContentLoaded', function() {
  startAutoRefresh();
});

function startAutoRefresh() {
  if (autoRefreshInterval) clearInterval(autoRefreshInterval);
  
  autoRefreshInterval = setInterval(function() {
    if (isAutoRefreshing) {
      refreshLogs();
    }
  }, 5000); // Refresh every 5 seconds
}

function toggleAutoRefresh() {
  const btn = document.getElementById('auto-refresh-btn');
  const icon = btn.querySelector('i');
  
  isAutoRefreshing = !isAutoRefreshing;
  
  if (isAutoRefreshing) {
    icon.className = 'fas fa-pause';
    btn.title = 'Pause auto-refresh';
    btn.classList.remove('btn-ghost-danger');
    btn.classList.add('btn-ghost-primary');
  } else {
    icon.className = 'fas fa-play';
    btn.title = 'Resume auto-refresh';
    btn.classList.remove('btn-ghost-primary');
    btn.classList.add('btn-ghost-danger');
  }
}

function refreshLogs() {
  const lines = document.getElementById('log-lines').value;
  
  fetch(`/applications/anthropic_claude-3-5-haiku/1/logs/stream?lines=${lines}`)
    .then(response => response.text())
    .then(data => {
      document.getElementById('log-content').textContent = data;
      
      // Auto-scroll to bottom if user is at bottom
      const container = document.getElementById('log-container');
      const isAtBottom = container.scrollTop + container.clientHeight >= container.scrollHeight - 10;
      
      if (isAtBottom) {
        scrollToBottom();
      }
      
      // Update statistics
      updateLogStats(data);
    })
    .catch(error => {
      console.error('Failed to refresh logs:', error);
    });
}

function filterLogs() {
  const level = document.getElementById('log-level-filter').value;
  const source = document.getElementById('log-source-filter').value;
  const search = document.getElementById('log-search').value;
  
  const params = new URLSearchParams();
  if (level) params.append('level', level);
  if (source) params.append('source', source);
  if (search) params.append('search', search);
  
  fetch(`/applications/anthropic_claude-3-5-haiku/1/logs/filter?${params.toString()}`)
    .then(response => response.text())
    .then(data => {
      document.getElementById('log-content').textContent = data;
      updateLogStats(data);
    });
}

function changeLinesCount() {
  refreshLogs();
}

function scrollToTop() {
  document.getElementById('log-container').scrollTop = 0;
}

function scrollToBottom() {
  const container = document.getElementById('log-container');
  container.scrollTop = container.scrollHeight;
}

function copyLogs() {
  const logContent = document.getElementById('log-content').textContent;
  navigator.clipboard.writeText(logContent).then(() => {
    showLogNotification('Logs copied to clipboard', 'success');
  }).catch(() => {
    // Fallback for browsers that don't support clipboard API
    const textarea = document.createElement('textarea');
    textarea.value = logContent;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);
    showLogNotification('Logs copied to clipboard', 'success');
  });
}

function clearLogs() {
  if (confirm('Are you sure you want to clear all logs? This action cannot be undone.')) {
    fetch(`/applications/anthropic_claude-3-5-haiku/1/logs/clear`, {
      method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        document.getElementById('log-content').textContent = '';
        updateLogStats('');
        showLogNotification('Logs cleared successfully', 'success');
      } else {
        showLogNotification('Failed to clear logs', 'danger');
      }
    });
  }
}

function updateLogStats(logContent) {
  const lines = logContent.split('\n').filter(line => line.trim());
  const errorCount = lines.filter(line => line.includes('ERROR')).length;
  const warningCount = lines.filter(line => line.includes('WARN')).length;
  const infoCount = lines.filter(line => line.includes('INFO')).length;
  
  document.getElementById('error-count').textContent = errorCount;
  document.getElementById('warning-count').textContent = warningCount;
  document.getElementById('info-count').textContent = infoCount;
  document.getElementById('total-lines').textContent = lines.length;
}

function showLogNotification(message, type = 'info') {
  // Simple notification system
  const notification = document.createElement('div');
  notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
  notification.innerHTML = `
    ${message}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  `;
  
  document.body.appendChild(notification);
  
  setTimeout(() => {
    if (notification.parentNode) {
      notification.parentNode.removeChild(notification);
    }
  }, 3000);
}

// Cleanup interval on page unload
window.addEventListener('beforeunload', function() {
  if (autoRefreshInterval) {
    clearInterval(autoRefreshInterval);
  }
});
</script>
